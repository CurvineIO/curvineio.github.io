<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-User-Manuals/csi" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">K8S CSI Driver | Curvine</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://curvineio.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://curvineio.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://curvineio.github.io/docs/User-Manuals/csi"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh_cn"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="K8S CSI Driver | Curvine"><meta data-rh="true" name="description" content="To facilitate quick integration with Curvine in cloud-native environments, Curvine provides CSI driver support. Your Pod containers can access Curvine through PV (Persistent Volume) without requiring application modifications, enabling seamless use of Curvine&#x27;s caching capabilities."><meta data-rh="true" property="og:description" content="To facilitate quick integration with Curvine in cloud-native environments, Curvine provides CSI driver support. Your Pod containers can access Curvine through PV (Persistent Volume) without requiring application modifications, enabling seamless use of Curvine&#x27;s caching capabilities."><link data-rh="true" rel="icon" href="/img/curvine_logo.ico"><link data-rh="true" rel="canonical" href="https://curvineio.github.io/docs/User-Manuals/csi"><link data-rh="true" rel="alternate" href="https://curvineio.github.io/docs/User-Manuals/csi" hreflang="en"><link data-rh="true" rel="alternate" href="https://curvineio.github.io/zh-cn/docs/User-Manuals/csi" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://curvineio.github.io/docs/User-Manuals/csi" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"User Manuals","item":"https://curvineio.github.io/docs/category/user-manuals"},{"@type":"ListItem","position":2,"name":"K8S CSI Driver","item":"https://curvineio.github.io/docs/User-Manuals/csi"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Curvine RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Curvine Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b44d61cb.css">
<script src="/assets/js/runtime~main.0ea55a57.js" defer="defer"></script>
<script src="/assets/js/main.c1e2ff02.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/curvine_logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/curvine_logo.png" alt="Curvine" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/curvine_logo.png" alt="Curvine" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Curvine</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/Overview/instroduction">Documents</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/community">Community</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/User-Manuals/csi">Latest üöß</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/docs/User-Manuals/csi" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/zh-cn/docs/User-Manuals/csi" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><a href="https://github.com/curvineio/curvine" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Overview/instroduction">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/Deploy/quick-start">Deploy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/user-manuals">User Manuals</a><button aria-label="Collapse sidebar category &#x27;User Manuals&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/ufs">Data Orchestration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/cache">Cache</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/webui">Web Management Interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/cli">Command Line Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/opt">Performance Tuning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/conf">Configuration Reference</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/User-Manuals/csi">K8S CSI Driver</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/fuse">Fuse Mode Access</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/s3-gateway">S3 Object Storage Gateway</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/User-Manuals/monitoring">Monitoring Metrics</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/benchmark">Benchmark</a><button aria-label="Expand sidebar category &#x27;Benchmark&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/architecture">Architecture</a><button aria-label="Expand sidebar category &#x27;Architecture&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/contributor-guide">Contributor Guide</a><button aria-label="Expand sidebar category &#x27;Contributor Guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/docs/category/user-manuals"><span>User Manuals</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">K8S CSI Driver</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>K8S CSI Driver</h1></header>
<p>To facilitate quick integration with Curvine in cloud-native environments, Curvine provides CSI driver support. Your Pod containers can access Curvine through <code>PV</code> (Persistent Volume) without requiring application modifications, enabling seamless use of Curvine&#x27;s caching capabilities.</p>
<p>The Curvine CSI driver follows the standard CSI specification and includes:</p>
<ul>
<li><code>CSI Controller</code>, deployed in <code>Deployment</code> or <code>Statefulset</code> mode</li>
<li><code>CSI Node Plugin</code>, deployed in <code>DaemonSet</code> mode</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture-overview">Architecture Overview<a href="#architecture-overview" class="hash-link" aria-label="Direct link to Architecture Overview" title="Direct link to Architecture Overview">‚Äã</a></h2>
<p>The Curvine CSI driver adopts the standard CSI architecture with two main components:</p>
<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="core-components">Core Components<a href="#core-components" class="hash-link" aria-label="Direct link to Core Components" title="Direct link to Core Components">‚Äã</a></h3>
<ol>
<li>
<p><strong>CSI Controller</strong></p>
<ul>
<li>Runs in the Control Plane</li>
<li>Responsible for Volume creation, deletion, Attach/Detach operations</li>
<li>Includes csi-provisioner and csi-attacher sidecars</li>
</ul>
</li>
<li>
<p><strong>CSI Node Plugin</strong></p>
<ul>
<li>Runs as DaemonSet on each Worker Node</li>
<li>Responsible for mounting Curvine storage to Pods</li>
<li>Uses FUSE technology for filesystem mounting</li>
</ul>
</li>
<li>
<p><strong>FUSE Mounting Mechanism</strong></p>
<ul>
<li>Directly mounts Curvine filesystem paths</li>
<li>Same paths share FUSE process, saving resources</li>
<li>Supports concurrent access by multiple Pods</li>
</ul>
</li>
</ol>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-requirements">Environment Requirements<a href="#environment-requirements" class="hash-link" aria-label="Direct link to Environment Requirements" title="Direct link to Environment Requirements">‚Äã</a></h3>
<ul>
<li>Kubernetes 1.19+</li>
<li>Helm 3.0+</li>
<li>Accessible Curvine cluster (Master node address and port)</li>
<li>Cluster administrator privileges</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="environment-check">Environment Check<a href="#environment-check" class="hash-link" aria-label="Direct link to Environment Check" title="Direct link to Environment Check">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check Kubernetes version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version --short</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check Helm version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm version --short</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check node status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get nodes</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="i-installing-curvine-csi">I. Installing Curvine CSI<a href="#i-installing-curvine-csi" class="hash-link" aria-label="Direct link to I. Installing Curvine CSI" title="Direct link to I. Installing Curvine CSI">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="11-get-helm-chart">1.1 Get Helm Chart<a href="#11-get-helm-chart" class="hash-link" aria-label="Direct link to 1.1 Get Helm Chart" title="Direct link to 1.1 Get Helm Chart">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm repo add curvine https://curvineio.github.io/helm-charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm repo update</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm search repo curvine --devel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm install curvine-csi curvine/curvine-csi \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace curvine-system \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace --devel \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --version 0.0.1-dev+7ffc6a2</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>The current Curvine Helm repository provides pre-release versions:</p><ul>
<li>Use <code>--devel</code> to view them, and replace the <code>--version</code> in the command above with your desired version</li>
<li>curvine-csi is installed by default in the <code>curvine-system</code> namespace via Helm</li>
<li>Official release versions will be provided progressively</li>
</ul></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="12-configure-custom-parameters-optional">1.2 Configure Custom Parameters (Optional)<a href="#12-configure-custom-parameters-optional" class="hash-link" aria-label="Direct link to 1.2 Configure Custom Parameters (Optional)" title="Direct link to 1.2 Configure Custom Parameters (Optional)">‚Äã</a></h3>
<p>curvine-csi supports rich customization parameters. If your network environment has restrictions, you can use custom images and other methods.</p>
<p>For example, create a <code>custom-values.yaml</code> file:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Image configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">repository</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ghcr.io/curvineio/curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">csi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">tag</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">pullPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> IfNotPresent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Controller configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">controller</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 500m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 512Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Node configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">node</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 128Mi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">limits</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">cpu</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 500m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">memory</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 512Mi</span><br></span></code></pre></div></div>
<p>Install with custom parameters using Helm:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">helm install curvine-csi curvine/curvine-csi \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --namespace curvine-system \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --create-namespace --devel \ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --values custom-values.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check installation status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm status curvine-csi -n curvine-system</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="14-upgrade-and-uninstall">1.4 Upgrade and Uninstall<a href="#14-upgrade-and-uninstall" class="hash-link" aria-label="Direct link to 1.4 Upgrade and Uninstall" title="Direct link to 1.4 Upgrade and Uninstall">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Upgrade</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm upgrade curvine curvine/curvine-csi -n curvine-system --devel --version xxxxx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Uninstall</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">helm uninstall curvine-csi -n curvine-system</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Complete cleanup (including namespace)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete namespace curvine-system</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ii-verification-and-status-check">II. Verification and Status Check<a href="#ii-verification-and-status-check" class="hash-link" aria-label="Direct link to II. Verification and Status Check" title="Direct link to II. Verification and Status Check">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="21-check-csi-driver-registration">2.1 Check CSI Driver Registration<a href="#21-check-csi-driver-registration" class="hash-link" aria-label="Direct link to 2.1 Check CSI Driver Registration" title="Direct link to 2.1 Check CSI Driver Registration">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check if CSI Driver is registered successfully</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get csidriver curvine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Example output:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># NAME      ATTACHREQUIRED   PODINFOONMOUNT   STORAGECAPACITY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># curvine   false            false            false</span><br></span></code></pre></div></div>
<p><strong>Parameter Explanation:</strong></p>
<ul>
<li><code>ATTACHREQUIRED: false</code> - No Attach operation needed (direct FUSE mount)</li>
<li><code>PODINFOONMOUNT: false</code> - No Pod information needed during mount</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="22-check-controller-status">2.2 Check Controller Status<a href="#22-check-controller-status" class="hash-link" aria-label="Direct link to 2.2 Check Controller Status" title="Direct link to 2.2 Check Controller Status">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check Controller Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get deployment -n curvine-system curvine-csi-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check Controller Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n curvine-system -l app=curvine-csi-controller</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check Controller logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n curvine-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -l app=curvine-csi-controller \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -c csi-plugin \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tail=50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check Provisioner Sidecar logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n curvine-system \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -l app=curvine-csi-controller \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -c csi-provisioner \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --tail=50</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="23-check-node-plugin-status">2.3 Check Node Plugin Status<a href="#23-check-node-plugin-status" class="hash-link" aria-label="Direct link to 2.3 Check Node Plugin Status" title="Direct link to 2.3 Check Node Plugin Status">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check Node DaemonSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get daemonset -n curvine-system curvine-csi-node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check all Node Plugin Pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -n curvine-system -l app=curvine-csi-node -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check specific Node logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n curvine-system curvine-csi-node-xxxxx -c csi-plugin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check Node Registrar logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl logs -n curvine-system curvine-csi-node-xxxxx -c node-driver-registrar</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="iii-storageclass-explained">III. StorageClass Explained<a href="#iii-storageclass-explained" class="hash-link" aria-label="Direct link to III. StorageClass Explained" title="Direct link to III. StorageClass Explained">‚Äã</a></h2>
<p>StorageClass is a resource in Kubernetes that defines storage types, used for automatic creation of dynamic PVs.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="31-storageclass-configuration-example">3.1 StorageClass Configuration Example<a href="#31-storageclass-configuration-example" class="hash-link" aria-label="Direct link to 3.1 StorageClass Configuration Example" title="Direct link to 3.1 StorageClass Configuration Example">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine                      </span><span class="token comment" style="color:#999988;font-style:italic"># CSI driver name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Delete                     </span><span class="token comment" style="color:#999988;font-style:italic"># Reclaim policy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Immediate              </span><span class="token comment" style="color:#999988;font-style:italic"># Binding mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">allowVolumeExpansion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic"># Allow expansion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Required: Curvine cluster connection information</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master-addrs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;master1:8995,master2:8995,master3:8995&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Required: Filesystem path prefix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fs-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/k8s-volumes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: Path creation strategy</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DirectoryOrCreate&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: FUSE parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">io-threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">worker-threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="32-parameter-details">3.2 Parameter Details<a href="#32-parameter-details" class="hash-link" aria-label="Direct link to 3.2 Parameter Details" title="Direct link to 3.2 Parameter Details">‚Äã</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="core-parameters">Core Parameters<a href="#core-parameters" class="hash-link" aria-label="Direct link to Core Parameters" title="Direct link to Core Parameters">‚Äã</a></h4>
<table><thead><tr><th>Parameter</th><th>Required</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><code>master-addrs</code></td><td>‚úÖ</td><td>Curvine Master node address list, comma-separated</td><td><code>&quot;10.0.0.1:8995,10.0.0.2:8995&quot;</code></td></tr><tr><td><code>fs-path</code></td><td>‚úÖ</td><td>Path prefix for dynamic PVs, actual path is <code>fs-path + pv-name</code></td><td><code>&quot;/k8s-volumes&quot;</code></td></tr><tr><td><code>path-type</code></td><td>‚ùå</td><td>Path creation strategy, defaults to <code>Directory</code></td><td><code>&quot;DirectoryOrCreate&quot;</code></td></tr><tr><td><code>io-threads</code></td><td>‚ùå</td><td>FUSE IO thread count</td><td><code>&quot;4&quot;</code></td></tr><tr><td><code>worker-threads</code></td><td>‚ùå</td><td>FUSE worker thread count</td><td><code>&quot;8&quot;</code></td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="path-creation-strategy-path-type">Path Creation Strategy (path-type)<a href="#path-creation-strategy-path-type" class="hash-link" aria-label="Direct link to Path Creation Strategy (path-type)" title="Direct link to Path Creation Strategy (path-type)">‚Äã</a></h4>
<ul>
<li>
<p><strong><code>Directory</code></strong> (default)</p>
<ul>
<li>Path must already exist</li>
<li>Recommended for production environments</li>
<li>Ensures path is pre-created by administrators</li>
</ul>
</li>
<li>
<p><strong><code>DirectoryOrCreate</code></strong></p>
<ul>
<li>Automatically creates path if it doesn&#x27;t exist</li>
<li>Suitable for testing and development environments</li>
<li>Note permission issues</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="reclaim-policy-reclaimpolicy">Reclaim Policy (reclaimPolicy)<a href="#reclaim-policy-reclaimpolicy" class="hash-link" aria-label="Direct link to Reclaim Policy (reclaimPolicy)" title="Direct link to Reclaim Policy (reclaimPolicy)">‚Äã</a></h4>
<ul>
<li>
<p><strong><code>Delete</code></strong> (recommended for dynamic PVs)</p>
<ul>
<li>Automatically deletes PV and storage data when PVC is deleted</li>
<li>Suitable for temporary data and testing environments</li>
</ul>
</li>
<li>
<p><strong><code>Retain</code></strong></p>
<ul>
<li>PV is retained after PVC deletion</li>
<li>Data needs manual cleanup</li>
<li>Suitable for important data protection</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="binding-mode-volumebindingmode">Binding Mode (volumeBindingMode)<a href="#binding-mode-volumebindingmode" class="hash-link" aria-label="Direct link to Binding Mode (volumeBindingMode)" title="Direct link to Binding Mode (volumeBindingMode)">‚Äã</a></h4>
<ul>
<li>
<p><strong><code>Immediate</code></strong> (default)</p>
<ul>
<li>PV is bound immediately after PVC creation</li>
<li>Suitable for single AZ clusters</li>
</ul>
</li>
<li>
<p><strong><code>WaitForFirstConsumer</code></strong></p>
<ul>
<li>Waits for Pod scheduling before binding PV</li>
<li>Suitable for multi-AZ clusters, ensures PV is available on the Pod&#x27;s node</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="33-dynamic-pv-path-generation-rules">3.3 Dynamic PV Path Generation Rules<a href="#33-dynamic-pv-path-generation-rules" class="hash-link" aria-label="Direct link to 3.3 Dynamic PV Path Generation Rules" title="Direct link to 3.3 Dynamic PV Path Generation Rules">‚Äã</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Actual mount path = fs-path + &quot;/&quot; + pv-name</span><br></span></code></pre></div></div>
<p><strong>Example:</strong></p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># StorageClass configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">fs-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/k8s-volumes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Auto-generated PV name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">pv-name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;pvc-1234-5678-abcd&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Final Curvine path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">Actual path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/k8s-volumes/pvc-1234-5678-abcd&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="34-create-storageclass">3.4 Create StorageClass<a href="#34-create-storageclass" class="hash-link" aria-label="Direct link to 3.4 Create StorageClass" title="Direct link to 3.4 Create StorageClass">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: curvine-sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">provisioner: curvine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reclaimPolicy: Delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumeBindingMode: Immediate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">allowVolumeExpansion: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">parameters:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  master-addrs: &quot;m0:8995,m1:8995,m2:8995&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  fs-path: &quot;/k8s-volumes&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  path-type: &quot;DirectoryOrCreate&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># View StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get storageclass curvine-sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Set as default StorageClass (optional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl patch storageclass curvine-sc \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -p &#x27;{&quot;metadata&quot;: {&quot;annotations&quot;:{&quot;storageclass.kubernetes.io/is-default-class&quot;:&quot;true&quot;}}}&#x27;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Replace the <code>master-addrs</code> in the example above with your actual master addresses.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="35-multiple-storageclass-scenarios">3.5 Multiple StorageClass Scenarios<a href="#35-multiple-storageclass-scenarios" class="hash-link" aria-label="Direct link to 3.5 Multiple StorageClass Scenarios" title="Direct link to 3.5 Multiple StorageClass Scenarios">‚Äã</a></h3>
<p>You can create multiple StorageClasses for different scenarios:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Production environment - strict mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">prod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> WaitForFirstConsumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master-addrs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;prod-master1:8995,prod-master2:8995&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fs-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/production&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Directory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Development environment - relaxed mode</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> storage.k8s.io/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dev</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">provisioner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">reclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Delete</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumeBindingMode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Immediate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">parameters</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master-addrs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;dev-master:8995&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">fs-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/development&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">path-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;DirectoryOrCreate&quot;</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="iv-static-pv-usage">IV. Static PV Usage<a href="#iv-static-pv-usage" class="hash-link" aria-label="Direct link to IV. Static PV Usage" title="Direct link to IV. Static PV Usage">‚Äã</a></h2>
<p>Static PV is used to mount existing data directories in Curvine, suitable for the following scenarios:</p>
<ul>
<li>Multiple clusters sharing the same data</li>
<li>Need for precise control over data paths</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="41-working-principle">4.1 Working Principle<a href="#41-working-principle" class="hash-link" aria-label="Direct link to 4.1 Working Principle" title="Direct link to 4.1 Working Principle">‚Äã</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Curvine cluster has existing data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Administrator creates PV, specifying curvine-path</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User creates PVC, binds to specified PV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pod mounts PVC</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="42-create-static-pv">4.2 Create Static PV<a href="#42-create-static-pv" class="hash-link" aria-label="Direct link to 4.2 Create Static PV" title="Direct link to 4.2 Create Static PV">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolume</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">static</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">capacity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100Gi                    </span><span class="token comment" style="color:#999988;font-style:italic"># Declared capacity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany                   </span><span class="token comment" style="color:#999988;font-style:italic"># Supports multi-Pod read-write</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">persistentVolumeReclaimPolicy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Retain  </span><span class="token comment" style="color:#999988;font-style:italic"># Retain data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">csi</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeHandle</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;existing-data-volume-001&quot;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Unique identifier</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeAttributes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Required: Curvine Master address</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">master-addrs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;m0:8995,m1:8995,m2:8995&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Required: Complete path in Curvine</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">curvine-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/production/user-data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Recommended: Use Directory to ensure path exists</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">path-type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Directory&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Optional: FUSE parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">io-threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">worker-threads</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;8&quot;</span><br></span></code></pre></div></div>
<p><strong>Parameter Explanation:</strong></p>
<ul>
<li><code>volumeHandle</code>: Any unique string, used to identify the PV</li>
<li><code>curvine-path</code>: Complete path in Curvine filesystem, must already exist</li>
<li><code>path-type: Directory</code>: Requires path to exist (recommended)</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="43-create-static-pvc">4.3 Create Static PVC<a href="#43-create-static-pvc" class="hash-link" aria-label="Direct link to 4.3 Create Static PVC" title="Direct link to 4.3 Create Static PVC">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pvc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 100Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Key: Specify the PV name to bind</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="44-verify-binding">4.4 Verify Binding<a href="#44-verify-binding" class="hash-link" aria-label="Direct link to 4.4 Verify Binding" title="Direct link to 4.4 Verify Binding">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Check PV status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pv curvine-pv-existing-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># STATUS should be Bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check PVC status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc curvine-pvc-existing-data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># STATUS should be Bound</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Check detailed information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pvc curvine-pvc-existing-data</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="45-using-static-pv-in-pod">4.5 Using Static PV in Pod<a href="#45-using-static-pv-in-pod" class="hash-link" aria-label="Direct link to 4.5 Using Static PV in Pod" title="Direct link to 4.5 Using Static PV in Pod">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> static</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pv</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pvc</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">existing</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="v-dynamic-pv-usage">V. Dynamic PV Usage<a href="#v-dynamic-pv-usage" class="hash-link" aria-label="Direct link to V. Dynamic PV Usage" title="Direct link to V. Dynamic PV Usage">‚Äã</a></h2>
<p>Dynamic PV is the most commonly used method, automatically created and managed by the CSI Controller.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="51-working-principle">5.1 Working Principle<a href="#51-working-principle" class="hash-link" aria-label="Direct link to 5.1 Working Principle" title="Direct link to 5.1 Working Principle">‚Äã</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">User creates PVC, specifying StorageClass</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CSI Provisioner automatically creates PV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Auto-generates Curvine path: fs-path + pv-name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">PVC automatically binds to PV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pod mounts PVC for use</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="52-create-dynamic-pvc">5.2 Create Dynamic PVC<a href="#52-create-dynamic-pvc" class="hash-link" aria-label="Direct link to 5.2 Create Dynamic PVC" title="Direct link to 5.2 Create Dynamic PVC">‚Äã</a></h3>
<p>Dynamic PVC requires specifying a storageclass, without specifying volumeName:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dynamic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sc    </span><span class="token comment" style="color:#999988;font-style:italic"># Specify StorageClass</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce               </span><span class="token comment" style="color:#999988;font-style:italic"># or ReadWriteMany</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi               </span><span class="token comment" style="color:#999988;font-style:italic"># Request capacity</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="53-automatic-path-generation-example">5.3 Automatic Path Generation Example<a href="#53-automatic-path-generation-example" class="hash-link" aria-label="Direct link to 5.3 Automatic Path Generation Example" title="Direct link to 5.3 Automatic Path Generation Example">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># StorageClass configuration</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">fs-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/k8s-volumes&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># PVC name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> my</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">dynamic</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Auto-generated PV</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># volumeHandle: pvc-1a2b3c4d-5e6f-7g8h-9i0j-k1l2m3n4o5p6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Actual Curvine path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /k8s-volumes/pvc-1a2b3c4d-5e6f-7g8h-9i0j-k1l2m3n4o5p6</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># You can use Curvine&#x27;s cv command to check if the volume was created correctly in the Curvine cluster</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./bin/cv fs ls /</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="54-dynamic-pv-complete-example">5.4 Dynamic PV Complete Example<a href="#54-dynamic-pv-complete-example" class="hash-link" aria-label="Direct link to 5.4 Dynamic PV Complete Example" title="Direct link to 5.4 Dynamic PV Complete Example">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Create dynamic PVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: app-data-pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  namespace: default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  storageClassName: curvine-sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  accessModes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  resources:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    requests:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      storage: 20Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Check PVC status (should automatically Bound)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc app-data-pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl describe pvc app-data-pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. Check auto-created PV</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. Create Pod using PVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f - &lt;&lt;EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apiVersion: v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">metadata:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  name: dynamic-pv-test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spec:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  containers:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: nginx:alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumeMounts:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - name: data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      mountPath: /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  - name: data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    persistentVolumeClaim:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      claimName: app-data-pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EOF</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. Test write and read</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec dynamic-pv-test -- sh -c &#x27;echo &quot;Hello Curvine&quot; &gt; /usr/share/nginx/html/index.html&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec dynamic-pv-test -- cat /usr/share/nginx/html/index.html</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vi-using-dynamic-pv-in-deployment">VI. Using Dynamic PV in Deployment<a href="#vi-using-dynamic-pv-in-deployment" class="hash-link" aria-label="Direct link to VI. Using Dynamic PV in Deployment" title="Direct link to VI. Using Dynamic PV in Deployment">‚Äã</a></h2>
<p>Deployment is suitable for stateless applications where multiple replicas share the same storage.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="61-architecture-pattern">6.1 Architecture Pattern<a href="#61-architecture-pattern" class="hash-link" aria-label="Direct link to 6.1 Architecture Pattern" title="Direct link to 6.1 Architecture Pattern">‚Äã</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">           Deployment (3 replicas)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               /      |      \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Pod-1  Pod-2  Pod-3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               \      |      /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Single PVC (RWX)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              Curvine Volume (Shared)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="62-complete-example">6.2 Complete Example<a href="#62-complete-example" class="hash-link" aria-label="Direct link to 6.2 Complete Example" title="Direct link to 6.2 Complete Example">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># deployment-with-pvc.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Create shared PVC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> PersistentVolumeClaim</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteMany</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10Gi</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Create Deployment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          if [ ! -f /usr/share/nginx/html/index.html ]; then</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">            echo &quot;&lt;h1&gt;App initialized by command&lt;/h1&gt;&quot; &gt; /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          fi</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          exec nginx -g &#x27;daemon off;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">livenessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">httpGet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">readinessProbe</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">httpGet</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">initialDelaySeconds</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">persistentVolumeClaim</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">claimName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">data</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pvc  </span><span class="token comment" style="color:#999988;font-style:italic"># Share the same PVC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Create Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">targetPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ClusterIP</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>For Deployment applications, Kubernetes is natively positioned for stateless services, meaning all replica Pods by default read and write to the same PV path. If your application requires different path isolation on Curvine, you can try using OpenKruise&#x27;s <code>CloneSets</code> as an alternative, which supports VolumeClaimTemplates. Reference: <a href="https://openkruise.io/zh/docs/user-manuals/cloneset" target="_blank" rel="noopener noreferrer">https://openkruise.io/zh/docs/user-manuals/cloneset</a></p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="63-deploy-and-verify">6.3 Deploy and Verify<a href="#63-deploy-and-verify" class="hash-link" aria-label="Direct link to 6.3 Deploy and Verify" title="Direct link to 6.3 Deploy and Verify">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Deploy application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f deployment-with-pvc.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Check PVC status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc shared-data-pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. Check all Pods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -l app=web-app -o wide</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. Verify all Pods mounted the same PVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -l app=web-app -o jsonpath=&#x27;{range .items[*]}{.metadata.name}{&quot;\t&quot;}{.spec.volumes[0].persistentVolumeClaim.claimName}{&quot;\n&quot;}{end}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. Write data in one Pod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POD1=$(kubectl get pod -l app=web-app -o jsonpath=&#x27;{.items[0].metadata.name}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec $POD1 -- sh -c &#x27;echo &quot;Hello from Pod 1&quot; &gt; /usr/share/nginx/html/test.html&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 6. Read data in another Pod (verify sharing)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">POD2=$(kubectl get pod -l app=web-app -o jsonpath=&#x27;{.items[1].metadata.name}&#x27;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec $POD2 -- cat /usr/share/nginx/html/test.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Should output: Hello from Pod 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 7. Verify Service access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run curl-test --image=curlimages/curl --rm -it --restart=Never -- curl http://web-app-service/test.html</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="vii-using-dynamic-pv-in-statefulset">VII. Using Dynamic PV in StatefulSet<a href="#vii-using-dynamic-pv-in-statefulset" class="hash-link" aria-label="Direct link to VII. Using Dynamic PV in StatefulSet" title="Direct link to VII. Using Dynamic PV in StatefulSet">‚Äã</a></h2>
<p>StatefulSet is suitable for stateful applications, where each Pod has independent persistent storage.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="71-architecture-pattern">7.1 Architecture Pattern<a href="#71-architecture-pattern" class="hash-link" aria-label="Direct link to 7.1 Architecture Pattern" title="Direct link to 7.1 Architecture Pattern">‚Äã</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        StatefulSet (3 replicas)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |         |         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         Pod-0     Pod-1     Pod-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |         |         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         PVC-0     PVC-1     PVC-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |         |         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          PV-0      PV-1      PV-2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            |         |         |</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     /path/pvc-0  /path/pvc-1  /path/pvc-2</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="72-complete-example">7.2 Complete Example<a href="#72-complete-example" class="hash-link" aria-label="Direct link to 7.2 Complete Example" title="Direct link to 7.2 Complete Example">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># statefulset-web-app.yaml</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Headless Service (required)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">clusterIP</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> None                </span><span class="token comment" style="color:#999988;font-style:italic"># Headless Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">port</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. StatefulSet with VolumeClaimTemplates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">namespace</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">service   </span><span class="token comment" style="color:#999988;font-style:italic"># Must specify Service</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">replicas</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">selector</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">matchLabels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">template</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">labels</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">app</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">containers</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">alpine</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">containerPort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> web</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">volumeMounts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data                </span><span class="token comment" style="color:#999988;font-style:italic"># Must match volumeClaimTemplates name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">mountPath</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /usr/share/nginx/html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">command</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          # Write hello world message with pod name</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;&lt;h1&gt;Hello from $(hostname)&lt;/h1&gt;&quot; &gt; /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;&lt;p&gt;This is my persistent storage!&lt;/p&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          echo &quot;&lt;p&gt;Created at: $(date)&lt;/p&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          # Start nginx</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          nginx -g &#x27;daemon off;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Key: VolumeClaimTemplates</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">volumeClaimTemplates</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> data                    </span><span class="token comment" style="color:#999988;font-style:italic"># PVC name prefix</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">storageClassName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> curvine</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">sc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">accessModes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> ReadWriteOnce             </span><span class="token comment" style="color:#999988;font-style:italic"># Independent storage for each Pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">resources</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">requests</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">storage</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 1Gi</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="73-deploy-and-verify">7.3 Deploy and Verify<a href="#73-deploy-and-verify" class="hash-link" aria-label="Direct link to 7.3 Deploy and Verify" title="Direct link to 7.3 Deploy and Verify">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Deploy StatefulSet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f statefulset-web-app.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Watch Pod creation order (created sequentially)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pods -l app=web-app -w</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. Check PVCs (auto-created, one per Pod)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pvc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Example output:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># data-web-app-0   Bound    pvc-xxx   1Gi       RWO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># data-web-app-1   Bound    pvc-yyy   1Gi       RWO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># data-web-app-2   Bound    pvc-zzz   1Gi       RWO</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. Check PVs (auto-created)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl get pv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 5. Verify each Pod has independent storage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">for i in 0 1 2; do</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  echo &quot;=== Pod web-app-$i ===&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  kubectl exec web-app-$i -- cat /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 6. Write custom data to Pod-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec web-app-0 -- sh -c \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &#x27;echo &quot;&lt;p&gt;Custom data from Pod-0&lt;/p&gt;&quot; &gt;&gt; /usr/share/nginx/html/index.html&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 7. Verify Pod-0&#x27;s data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec web-app-0 -- cat /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 8. Verify Pod-1 doesn&#x27;t have Pod-0&#x27;s custom data (independent storage)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec web-app-1 -- cat /usr/share/nginx/html/index.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 9. Test persistence: Data remains after deleting Pod-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod web-app-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Wait for Pod to be recreated</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl wait --for=condition=Ready pod/web-app-0 --timeout=60s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Verify data still exists</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl exec web-app-0 -- cat /usr/share/nginx/html/index.html</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="74-statefulset-features">7.4 StatefulSet Features<a href="#74-statefulset-features" class="hash-link" aria-label="Direct link to 7.4 StatefulSet Features" title="Direct link to 7.4 StatefulSet Features">‚Äã</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pvc-naming-convention">PVC Naming Convention<a href="#pvc-naming-convention" class="hash-link" aria-label="Direct link to PVC Naming Convention" title="Direct link to PVC Naming Convention">‚Äã</a></h4>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PVC name = volumeClaimTemplate.name + &quot;-&quot; + StatefulSet.name + &quot;-&quot; + Pod ordinal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Example:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-web-app-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-web-app-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">data-web-app-2</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="pod-and-pvc-lifecycle">Pod and PVC Lifecycle<a href="#pod-and-pvc-lifecycle" class="hash-link" aria-label="Direct link to Pod and PVC Lifecycle" title="Direct link to Pod and PVC Lifecycle">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Delete Pod, PVC is not deleted</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pod web-app-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Pod is recreated and automatically binds back to the original PVC, data is retained</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Delete StatefulSet, retain PVCs (recommended)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete statefulset web-app --cascade=orphan</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># PVCs and data are retained</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. Delete StatefulSet and Pods, but retain PVCs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete statefulset web-app</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># PVCs need manual deletion</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 4. Manually delete PVC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl delete pvc data-web-app-0</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="scaling">Scaling<a href="#scaling" class="hash-link" aria-label="Direct link to Scaling" title="Direct link to Scaling">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 1. Scale up (increase replicas)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale statefulset web-app --replicas=5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Automatically creates web-app-3, web-app-4 and corresponding PVCs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 2. Scale down (decrease replicas)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale statefulset web-app --replicas=2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># web-app-2 is deleted, but PVC data-web-app-2 is retained</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 3. Scale up again</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl scale statefulset web-app --replicas=3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># web-app-2 is recreated and binds back to data-web-app-2, data is restored</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="fuse-process-sharing">FUSE Process Sharing<a href="#fuse-process-sharing" class="hash-link" aria-label="Direct link to FUSE Process Sharing" title="Direct link to FUSE Process Sharing">‚Äã</a></h4>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Conditions for multiple PVs to share a FUSE process:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 1. Same master-addrs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Same curvine-path</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Example: These two PVs will share a FUSE process</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">PV1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master-addrs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.0.0.1:8995&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">curvine-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/shared-data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">PV2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">master-addrs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10.0.0.1:8995&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">curvine-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/shared-data&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># These two PVs will have independent FUSE processes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">PV3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">curvine-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/data-1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">PV4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">curvine-path</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;/data-2&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix">Appendix<a href="#appendix" class="hash-link" aria-label="Direct link to Appendix" title="Direct link to Appendix">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="helm-custom-parameters">Helm Custom Parameters<a href="#helm-custom-parameters" class="hash-link" aria-label="Direct link to Helm Custom Parameters" title="Direct link to Helm Custom Parameters">‚Äã</a></h3>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="global-settings">Global Settings<a href="#global-settings" class="hash-link" aria-label="Direct link to Global Settings" title="Direct link to Global Settings">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>global.namespace</code></td><td>string</td><td><code>curvine-system</code></td><td>Namespace where CSI driver is deployed</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="image-settings">Image Settings<a href="#image-settings" class="hash-link" aria-label="Direct link to Image Settings" title="Direct link to Image Settings">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>image.repository</code></td><td>string</td><td><code>ghcr.io/curvineio/curvine-csi</code></td><td>CSI driver image repository address</td></tr><tr><td><code>image.tag</code></td><td>string</td><td><code>latest</code></td><td>CSI driver image tag version</td></tr><tr><td><code>image.pullPolicy</code></td><td>string</td><td><code>Always</code></td><td>Image pull policy (Always/IfNotPresent/Never)</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="csi-driver-settings">CSI Driver Settings<a href="#csi-driver-settings" class="hash-link" aria-label="Direct link to CSI Driver Settings" title="Direct link to CSI Driver Settings">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>csiDriver.name</code></td><td>string</td><td><code>curvine</code></td><td>CSI driver name identifier</td></tr><tr><td><code>csiDriver.attachRequired</code></td><td>boolean</td><td><code>false</code></td><td>Whether attach operation is required (volume attachment to node)</td></tr><tr><td><code>csiDriver.podInfoOnMount</code></td><td>boolean</td><td><code>false</code></td><td>Whether Pod information is required during mount</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="controller-settings">Controller Settings<a href="#controller-settings" class="hash-link" aria-label="Direct link to Controller Settings" title="Direct link to Controller Settings">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>controller.name</code></td><td>string</td><td><code>curvine-csi-controller</code></td><td>Controller Deployment name</td></tr><tr><td><code>controller.replicas</code></td><td>int</td><td><code>1</code></td><td>Number of Controller replicas</td></tr><tr><td><code>controller.priorityClassName</code></td><td>string</td><td><code>system-cluster-critical</code></td><td>Controller priority class name (high priority)</td></tr><tr><td><code>controller.container.name</code></td><td>string</td><td><code>csi-plugin</code></td><td>Main container name</td></tr><tr><td><code>controller.container.command</code></td><td>array</td><td><code>[&quot;/opt/curvine/csi&quot;]</code></td><td>Container start command</td></tr><tr><td><code>controller.container.args</code></td><td>array</td><td>See values.yaml</td><td>Container start arguments</td></tr><tr><td><code>controller.container.env.CSI_ENDPOINT</code></td><td>string</td><td><code>unix:///csi/csi.sock</code></td><td>CSI socket endpoint address</td></tr><tr><td><code>controller.container.livenessProbe.failureThreshold</code></td><td>int</td><td><code>5</code></td><td>Liveness probe failure threshold</td></tr><tr><td><code>controller.container.livenessProbe.initialDelaySeconds</code></td><td>int</td><td><code>10</code></td><td>Liveness probe initial delay seconds</td></tr><tr><td><code>controller.container.livenessProbe.periodSeconds</code></td><td>int</td><td><code>10</code></td><td>Liveness probe check period (seconds)</td></tr><tr><td><code>controller.container.livenessProbe.timeoutSeconds</code></td><td>int</td><td><code>3</code></td><td>Liveness probe timeout (seconds)</td></tr><tr><td><code>controller.container.ports.healthz</code></td><td>int</td><td><code>9909</code></td><td>Health check port</td></tr><tr><td><code>controller.container.securityContext.privileged</code></td><td>boolean</td><td><code>true</code></td><td>Whether to run in privileged mode</td></tr><tr><td><code>controller.container.securityContext.capabilities.add</code></td><td>array</td><td><code>[SYS_ADMIN]</code></td><td>Added Linux Capabilities</td></tr><tr><td><code>controller.tolerations</code></td><td>array</td><td>See values.yaml</td><td>Pod toleration configuration (allows CriticalAddons scheduling)</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="controller-sidecar-container-configuration">Controller Sidecar Container Configuration<a href="#controller-sidecar-container-configuration" class="hash-link" aria-label="Direct link to Controller Sidecar Container Configuration" title="Direct link to Controller Sidecar Container Configuration">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>controller.sidecars.provisioner.image</code></td><td>string</td><td><code>quay.io/k8scsi/csi-provisioner:v1.6.0</code></td><td>Provisioner sidecar image</td></tr><tr><td><code>controller.sidecars.provisioner.args</code></td><td>array</td><td>See values.yaml</td><td>Provisioner arguments (timeout 60s, log level v5)</td></tr><tr><td><code>controller.sidecars.attacher.image</code></td><td>string</td><td><code>registry.k8s.io/sig-storage/csi-attacher:v4.5.0</code></td><td>Attacher sidecar image</td></tr><tr><td><code>controller.sidecars.attacher.args</code></td><td>array</td><td>See values.yaml</td><td>Attacher arguments (log level v5)</td></tr><tr><td><code>controller.sidecars.livenessProbe.image</code></td><td>string</td><td><code>registry.k8s.io/sig-storage/livenessprobe:v2.11.0</code></td><td>LivenessProbe sidecar image</td></tr><tr><td><code>controller.sidecars.livenessProbe.args</code></td><td>array</td><td>See values.yaml</td><td>LivenessProbe arguments</td></tr><tr><td><code>controller.sidecars.livenessProbe.env.HEALTH_PORT</code></td><td>string</td><td><code>&quot;9909&quot;</code></td><td>Health check port</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="node-settings">Node Settings<a href="#node-settings" class="hash-link" aria-label="Direct link to Node Settings" title="Direct link to Node Settings">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>node.name</code></td><td>string</td><td><code>curvine-csi-node</code></td><td>Node DaemonSet name</td></tr><tr><td><code>node.priorityClassName</code></td><td>string</td><td><code>system-node-critical</code></td><td>Node priority class name (node critical level)</td></tr><tr><td><code>node.dnsPolicy</code></td><td>string</td><td><code>ClusterFirstWithHostNet</code></td><td>DNS policy (cluster first + host network)</td></tr><tr><td><code>node.container.name</code></td><td>string</td><td><code>csi-plugin</code></td><td>Main container name</td></tr><tr><td><code>node.container.command</code></td><td>array</td><td><code>[&quot;/opt/curvine/csi&quot;]</code></td><td>Container start command</td></tr><tr><td><code>node.container.args</code></td><td>array</td><td>See values.yaml</td><td>Container start arguments</td></tr><tr><td><code>node.container.env.CSI_ENDPOINT</code></td><td>string</td><td><code>unix:///csi/csi.sock</code></td><td>CSI socket endpoint address</td></tr><tr><td><code>node.container.livenessProbe.failureThreshold</code></td><td>int</td><td><code>5</code></td><td>Liveness probe failure threshold</td></tr><tr><td><code>node.container.livenessProbe.initialDelaySeconds</code></td><td>int</td><td><code>10</code></td><td>Liveness probe initial delay seconds</td></tr><tr><td><code>node.container.livenessProbe.periodSeconds</code></td><td>int</td><td><code>10</code></td><td>Liveness probe check period (seconds)</td></tr><tr><td><code>node.container.livenessProbe.timeoutSeconds</code></td><td>int</td><td><code>3</code></td><td>Liveness probe timeout (seconds)</td></tr><tr><td><code>node.container.ports.healthz</code></td><td>int</td><td><code>9909</code></td><td>Health check port</td></tr><tr><td><code>node.container.securityContext.privileged</code></td><td>boolean</td><td><code>true</code></td><td>Whether to run in privileged mode</td></tr><tr><td><code>node.container.lifecycle.preStop</code></td><td>object</td><td>See values.yaml</td><td>Container pre-stop hook (cleanup socket files)</td></tr><tr><td><code>node.tolerations</code></td><td>array</td><td><code>[{operator: Exists}]</code></td><td>Pod toleration configuration (tolerates all taints)</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="node-sidecar-container-configuration">Node Sidecar Container Configuration<a href="#node-sidecar-container-configuration" class="hash-link" aria-label="Direct link to Node Sidecar Container Configuration" title="Direct link to Node Sidecar Container Configuration">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>node.sidecars.nodeDriverRegistrar.image</code></td><td>string</td><td><code>quay.io/k8scsi/csi-node-driver-registrar:v2.1.0</code></td><td>Node driver registrar image</td></tr><tr><td><code>node.sidecars.nodeDriverRegistrar.args</code></td><td>array</td><td>See values.yaml</td><td>Registrar arguments (log level v5)</td></tr><tr><td><code>node.sidecars.nodeDriverRegistrar.env.ADDRESS</code></td><td>string</td><td><code>/csi/csi.sock</code></td><td>CSI socket address</td></tr><tr><td><code>node.sidecars.nodeDriverRegistrar.env.DRIVER_REG_SOCK_PATH</code></td><td>string</td><td><code>/var/lib/kubelet/csi-plugins/csi.curvine.io/csi.sock</code></td><td>Driver registration path in Kubelet</td></tr><tr><td><code>node.sidecars.livenessProbe.image</code></td><td>string</td><td><code>registry.k8s.io/sig-storage/livenessprobe:v2.11.0</code></td><td>LivenessProbe sidecar image</td></tr><tr><td><code>node.sidecars.livenessProbe.args</code></td><td>array</td><td>See values.yaml</td><td>LivenessProbe arguments</td></tr><tr><td><code>node.sidecars.livenessProbe.env.ADDRESS</code></td><td>string</td><td><code>/csi/csi.sock</code></td><td>CSI socket address</td></tr><tr><td><code>node.sidecars.livenessProbe.env.HEALTH_PORT</code></td><td>string</td><td><code>&quot;9909&quot;</code></td><td>Health check port</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="node-host-path-configuration">Node Host Path Configuration<a href="#node-host-path-configuration" class="hash-link" aria-label="Direct link to Node Host Path Configuration" title="Direct link to Node Host Path Configuration">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>node.hostPaths.pluginDir.path</code></td><td>string</td><td><code>/var/lib/kubelet/csi-plugins/csi.curvine.io/</code></td><td>CSI plugin directory path</td></tr><tr><td><code>node.hostPaths.pluginDir.type</code></td><td>string</td><td><code>DirectoryOrCreate</code></td><td>Path type (create if not exists)</td></tr><tr><td><code>node.hostPaths.kubeletDir.path</code></td><td>string</td><td><code>/var/lib/kubelet</code></td><td>Kubelet working directory path</td></tr><tr><td><code>node.hostPaths.kubeletDir.type</code></td><td>string</td><td><code>DirectoryOrCreate</code></td><td>Path type (create if not exists)</td></tr><tr><td><code>node.hostPaths.registrationDir.path</code></td><td>string</td><td><code>/var/lib/kubelet/plugins_registry/</code></td><td>Plugin registration directory path</td></tr><tr><td><code>node.hostPaths.registrationDir.type</code></td><td>string</td><td><code>Directory</code></td><td>Path type (must exist)</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="service-account-settings">Service Account Settings<a href="#service-account-settings" class="hash-link" aria-label="Direct link to Service Account Settings" title="Direct link to Service Account Settings">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>serviceAccount.controller.name</code></td><td>string</td><td><code>curvine-csi-controller-sa</code></td><td>Controller service account name</td></tr><tr><td><code>serviceAccount.node.name</code></td><td>string</td><td><code>curvine-csi-node-sa</code></td><td>Node service account name</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="rbac-configuration">RBAC Configuration<a href="#rbac-configuration" class="hash-link" aria-label="Direct link to RBAC Configuration" title="Direct link to RBAC Configuration">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>rbac.create</code></td><td>boolean</td><td><code>true</code></td><td>Whether to create RBAC resources (ClusterRole/ClusterRoleBinding)</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="configmap-configuration-curvine-cluster-configuration">ConfigMap Configuration (Curvine Cluster Configuration)<a href="#configmap-configuration-curvine-cluster-configuration" class="hash-link" aria-label="Direct link to ConfigMap Configuration (Curvine Cluster Configuration)" title="Direct link to ConfigMap Configuration (Curvine Cluster Configuration)">‚Äã</a></h4>
<table><thead><tr><th>Parameter Path</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>configMap.name</code></td><td>string</td><td><code>curvine-config</code></td><td>ConfigMap name</td></tr><tr><td><code>configMap.defaultMode</code></td><td>octal</td><td><code>0755</code></td><td>File default permission mode</td></tr><tr><td><code>configMap.data.curvineClusterToml</code></td><td>string</td><td>See values.yaml</td><td>Curvine cluster configuration file (TOML format)</td></tr><tr><td><code>configMap.data.curvineEnvSh</code></td><td>string</td><td>See values.yaml</td><td>Curvine environment variables script</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="curvine-cluster-configuration-parameters-in-configmap">Curvine Cluster Configuration Parameters in ConfigMap<a href="#curvine-cluster-configuration-parameters-in-configmap" class="hash-link" aria-label="Direct link to Curvine Cluster Configuration Parameters in ConfigMap" title="Direct link to Curvine Cluster Configuration Parameters in ConfigMap">‚Äã</a></h4>
<table><thead><tr><th>Configuration Item</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>client.master_addrs</code></td><td>array</td><td><code>[{hostname: &quot;localhost&quot;, port: 8995}]</code></td><td>Curvine Master node address list</td></tr><tr><td><code>log.level</code></td><td>string</td><td><code>&quot;info&quot;</code></td><td>Log level (debug/info/warn/error)</td></tr><tr><td><code>log.log_dir</code></td><td>string</td><td><code>&quot;stdout&quot;</code></td><td>Log output directory (stdout for standard output)</td></tr><tr><td><code>log.file_name</code></td><td>string</td><td><code>&quot;curvine.log&quot;</code></td><td>Log file name</td></tr></tbody></table>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="storageclass-parameters-configured-at-usage-time">StorageClass Parameters (Configured at Usage Time)<a href="#storageclass-parameters-configured-at-usage-time" class="hash-link" aria-label="Direct link to StorageClass Parameters (Configured at Usage Time)" title="Direct link to StorageClass Parameters (Configured at Usage Time)">‚Äã</a></h4>
<table><thead><tr><th>Parameter Name</th><th>Required</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>master-addrs</code></td><td><strong>Required</strong></td><td>string</td><td>None</td><td>Curvine Master node addresses, format: <code>host:port,host:port</code></td></tr><tr><td><code>fs-path</code></td><td><strong>Required</strong></td><td>string</td><td>None</td><td>Filesystem path prefix, each PV creates: <code>fs-path + pv-name</code></td></tr><tr><td><code>path-type</code></td><td>Optional</td><td>string</td><td><code>Directory</code></td><td>Path creation strategy: <code>DirectoryOrCreate</code> or <code>Directory</code></td></tr><tr><td><code>io-threads</code></td><td>Optional</td><td>string</td><td>None</td><td>FUSE IO thread count</td></tr><tr><td><code>worker-threads</code></td><td>Optional</td><td>string</td><td>None</td><td>FUSE worker thread count</td></tr></tbody></table></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/curvineio/curvine-doc/edit/main/docs/3-User-Manuals/07-csi.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/User-Manuals/conf"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Configuration Reference</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/User-Manuals/fuse"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Fuse Mode Access</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture-overview" class="table-of-contents__link toc-highlight">Architecture Overview</a><ul><li><a href="#core-components" class="table-of-contents__link toc-highlight">Core Components</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#environment-requirements" class="table-of-contents__link toc-highlight">Environment Requirements</a></li><li><a href="#environment-check" class="table-of-contents__link toc-highlight">Environment Check</a></li></ul></li><li><a href="#i-installing-curvine-csi" class="table-of-contents__link toc-highlight">I. Installing Curvine CSI</a><ul><li><a href="#11-get-helm-chart" class="table-of-contents__link toc-highlight">1.1 Get Helm Chart</a></li><li><a href="#12-configure-custom-parameters-optional" class="table-of-contents__link toc-highlight">1.2 Configure Custom Parameters (Optional)</a></li><li><a href="#14-upgrade-and-uninstall" class="table-of-contents__link toc-highlight">1.4 Upgrade and Uninstall</a></li></ul></li><li><a href="#ii-verification-and-status-check" class="table-of-contents__link toc-highlight">II. Verification and Status Check</a><ul><li><a href="#21-check-csi-driver-registration" class="table-of-contents__link toc-highlight">2.1 Check CSI Driver Registration</a></li><li><a href="#22-check-controller-status" class="table-of-contents__link toc-highlight">2.2 Check Controller Status</a></li><li><a href="#23-check-node-plugin-status" class="table-of-contents__link toc-highlight">2.3 Check Node Plugin Status</a></li></ul></li><li><a href="#iii-storageclass-explained" class="table-of-contents__link toc-highlight">III. StorageClass Explained</a><ul><li><a href="#31-storageclass-configuration-example" class="table-of-contents__link toc-highlight">3.1 StorageClass Configuration Example</a></li><li><a href="#32-parameter-details" class="table-of-contents__link toc-highlight">3.2 Parameter Details</a></li><li><a href="#33-dynamic-pv-path-generation-rules" class="table-of-contents__link toc-highlight">3.3 Dynamic PV Path Generation Rules</a></li><li><a href="#34-create-storageclass" class="table-of-contents__link toc-highlight">3.4 Create StorageClass</a></li><li><a href="#35-multiple-storageclass-scenarios" class="table-of-contents__link toc-highlight">3.5 Multiple StorageClass Scenarios</a></li></ul></li><li><a href="#iv-static-pv-usage" class="table-of-contents__link toc-highlight">IV. Static PV Usage</a><ul><li><a href="#41-working-principle" class="table-of-contents__link toc-highlight">4.1 Working Principle</a></li><li><a href="#42-create-static-pv" class="table-of-contents__link toc-highlight">4.2 Create Static PV</a></li><li><a href="#43-create-static-pvc" class="table-of-contents__link toc-highlight">4.3 Create Static PVC</a></li><li><a href="#44-verify-binding" class="table-of-contents__link toc-highlight">4.4 Verify Binding</a></li><li><a href="#45-using-static-pv-in-pod" class="table-of-contents__link toc-highlight">4.5 Using Static PV in Pod</a></li></ul></li><li><a href="#v-dynamic-pv-usage" class="table-of-contents__link toc-highlight">V. Dynamic PV Usage</a><ul><li><a href="#51-working-principle" class="table-of-contents__link toc-highlight">5.1 Working Principle</a></li><li><a href="#52-create-dynamic-pvc" class="table-of-contents__link toc-highlight">5.2 Create Dynamic PVC</a></li><li><a href="#53-automatic-path-generation-example" class="table-of-contents__link toc-highlight">5.3 Automatic Path Generation Example</a></li><li><a href="#54-dynamic-pv-complete-example" class="table-of-contents__link toc-highlight">5.4 Dynamic PV Complete Example</a></li></ul></li><li><a href="#vi-using-dynamic-pv-in-deployment" class="table-of-contents__link toc-highlight">VI. Using Dynamic PV in Deployment</a><ul><li><a href="#61-architecture-pattern" class="table-of-contents__link toc-highlight">6.1 Architecture Pattern</a></li><li><a href="#62-complete-example" class="table-of-contents__link toc-highlight">6.2 Complete Example</a></li><li><a href="#63-deploy-and-verify" class="table-of-contents__link toc-highlight">6.3 Deploy and Verify</a></li></ul></li><li><a href="#vii-using-dynamic-pv-in-statefulset" class="table-of-contents__link toc-highlight">VII. Using Dynamic PV in StatefulSet</a><ul><li><a href="#71-architecture-pattern" class="table-of-contents__link toc-highlight">7.1 Architecture Pattern</a></li><li><a href="#72-complete-example" class="table-of-contents__link toc-highlight">7.2 Complete Example</a></li><li><a href="#73-deploy-and-verify" class="table-of-contents__link toc-highlight">7.3 Deploy and Verify</a></li><li><a href="#74-statefulset-features" class="table-of-contents__link toc-highlight">7.4 StatefulSet Features</a></li></ul></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a><ul><li><a href="#helm-custom-parameters" class="table-of-contents__link toc-highlight">Helm Custom Parameters</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/Deploy/quick-start">Quick Start</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/xfxMQKv3" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/szbr8896" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/curvineio/curvine" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 Curvine Project Authors.<br>
                  Open source under Apache License 20. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>