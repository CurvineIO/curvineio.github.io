"use strict";(self.webpackChunkcurvine_doc=self.webpackChunkcurvine_doc||[]).push([[453],{5581:(e,n,i)=>{i.d(n,{A:()=>t});const t="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDYwMCAyMDAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPCEtLSBCYWNrZ3JvdW5kIC0tPgogIDxyZWN0IHdpZHRoPSI2MDAiIGhlaWdodD0iMjAwIiBmaWxsPSIjZjhmOWZhIiBzdHJva2U9Im5vbmUiLz4KICAKICA8IS0tIFMzIENsaWVudCAtLT4KICA8cmVjdCB4PSIyMCIgeT0iNjAiIHdpZHRoPSIxMjAiIGhlaWdodD0iODAiIHJ4PSI4IiBmaWxsPSIjZTNmMmZkIiBzdHJva2U9IiMxOTc2ZDIiIHN0cm9rZS13aWR0aD0iMiIvPgogIDx0ZXh0IHg9IjgwIiB5PSI4NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iIzE5NzZkMiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+UzMg5a6i5oi356uvPC90ZXh0PgogIDx0ZXh0IHg9IjgwIiB5PSIxMDUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzE5NzZkMiIgdGV4dC1hbmNob3I9Im1pZGRsZSI+KEFXUyBDTEnnrYkpPC90ZXh0PgogIAogIDwhLS0gUzMgR2F0ZXdheSAtLT4KICA8cmVjdCB4PSIyMjAiIHk9IjYwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjgwIiByeD0iOCIgZmlsbD0iI2U4ZjVlOCIgc3Ryb2tlPSIjMzg4ZTNjIiBzdHJva2Utd2lkdGg9IjIiLz4KICA8dGV4dCB4PSIzMDAiIHk9Ijg1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTIiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMzg4ZTNjIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TMyBHYXRld2F5PC90ZXh0PgogIDx0ZXh0IHg9IjMwMCIgeT0iMTA1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTAiIGZpbGw9IiMzODhlM2MiIHRleHQtYW5jaG9yPSJtaWRkbGUiPijnvZHlhbPmnI3liqEpPC90ZXh0PgogIAogIDwhLS0gQ3VydmluZSBVRlMgLS0+CiAgPHJlY3QgeD0iNDYwIiB5PSI2MCIgd2lkdGg9IjEyMCIgaGVpZ2h0PSI4MCIgcng9IjgiIGZpbGw9IiNmZmYzZTAiIHN0cm9rZT0iI2Y1N2MwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPHRleHQgeD0iNTIwIiB5PSI4NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iI2Y1N2MwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Q3VydmluZSBVRlM8L3RleHQ+CiAgPHRleHQgeD0iNTIwIiB5PSIxMDUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iI2Y1N2MwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+KOWIhuW4g+W8j+WtmOWCqCk8L3RleHQ+CiAgCiAgPCEtLSBBcnJvd3Mgd2l0aCBsYWJlbHMgLS0+CiAgPCEtLSBTMyBBUEkgYXJyb3cgLS0+CiAgPHBhdGggZD0iTSAxNDAgMTAwIEwgMjIwIDEwMCIgc3Ryb2tlPSIjMmMzZTUwIiBzdHJva2Utd2lkdGg9IjIiIG1hcmtlci1lbmQ9InVybCgjYXJyb3cpIi8+CiAgPHRleHQgeD0iMTgwIiB5PSI5NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEwIiBmaWxsPSIjMmMzZTUwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TMyBBUEk8L3RleHQ+CiAgCiAgPCEtLSBVRlMgQVBJIGFycm93IC0tPgogIDxwYXRoIGQ9Ik0gMzgwIDEwMCBMIDQ2MCAxMDAiIHN0cm9rZT0iIzJjM2U1MCIgc3Ryb2tlLXdpZHRoPSIyIiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93KSIvPgogIDx0ZXh0IHg9IjQyMCIgeT0iOTUiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZmlsbD0iIzJjM2U1MCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+VUZTIEFQSTwvdGV4dD4KICAKICA8IS0tIEFycm93IG1hcmtlciAtLT4KICA8ZGVmcz4KICAgIDxtYXJrZXIgaWQ9ImFycm93IiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIHJlZlg9IjkiIHJlZlk9IjMiIG9yaWVudD0iYXV0byIgbWFya2VyVW5pdHM9InN0cm9rZVdpZHRoIj4KICAgICAgPHBvbHlnb24gcG9pbnRzPSIwLDAgMCw2IDksMyIgZmlsbD0iIzJjM2U1MCIvPgogICAgPC9tYXJrZXI+CiAgPC9kZWZzPgo8L3N2Zz4K"},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>a});var t=i(6540);const s={},r=t.createContext(s);function l(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),t.createElement(r.Provider,{value:n},e.children)}},8784:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"User-Manuals/Access/s3-gateway","title":"S3 Object Storage Gateway","description":"Overview","source":"@site/docs/3-User-Manuals/4-Access/02-s3-gateway.md","sourceDirName":"3-User-Manuals/4-Access","slug":"/User-Manuals/Access/s3-gateway","permalink":"/docs/User-Manuals/Access/s3-gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/curvineio/curvine-doc/edit/main/docs/3-User-Manuals/4-Access/02-s3-gateway.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Fuse Mode Access","permalink":"/docs/User-Manuals/Access/fuse"},"next":{"title":"SDK Access","permalink":"/docs/User-Manuals/Access/sdk"}}');var s=i(4848),r=i(8453);const l={},a="S3 Object Storage Gateway",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:3},{value:"Architecture Overview",id:"architecture-overview",level:3},{value:"Supported S3 Operations",id:"supported-s3-operations",level:2},{value:"Object Operations",id:"object-operations",level:3},{value:"Bucket Operations",id:"bucket-operations",level:3},{value:"Advanced Features",id:"advanced-features",level:3},{value:"Service Management",id:"service-management",level:2},{value:"Start Service",id:"start-service",level:3},{value:"Stop Service",id:"stop-service",level:3},{value:"Check Service Status",id:"check-service-status",level:3},{value:"Restart Service",id:"restart-service",level:3},{value:"View Logs",id:"view-logs",level:3},{value:"Startup Parameters",id:"startup-parameters",level:2},{value:"Command Line Arguments",id:"command-line-arguments",level:3},{value:"Configuration File Parameters",id:"configuration-file-parameters",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Credential Management",id:"credential-management",level:2},{value:"Add Credentials",id:"add-credentials",level:3},{value:"Generate Random Credentials",id:"generate-random-credentials",level:3},{value:"List Credentials",id:"list-credentials",level:3},{value:"View Cache Statistics",id:"view-cache-statistics",level:3},{value:"Credential Storage",id:"credential-storage",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"AWS CLI",id:"aws-cli",level:3},{value:"MinIO Client (mc)",id:"minio-client-mc",level:3},{value:"Python boto3",id:"python-boto3",level:3},{value:"Range Request Examples",id:"range-request-examples",level:3},{value:"Multi-Instance Deployment",id:"multi-instance-deployment",level:2},{value:"Load Balancer Configuration",id:"load-balancer-configuration",level:3},{value:"Using Nginx",id:"using-nginx",level:4},{value:"Using HAProxy",id:"using-haproxy",level:4},{value:"Multi-Instance Startup",id:"multi-instance-startup",level:3},{value:"High Availability Configuration",id:"high-availability-configuration",level:3},{value:"Configure Shared Storage",id:"configure-shared-storage",level:4},{value:"Health Checks",id:"health-checks",level:4},{value:"Performance Optimization",id:"performance-optimization",level:3},{value:"System-Level Optimization",id:"system-level-optimization",level:4},{value:"Configuration Tuning",id:"configuration-tuning",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Common Issues",id:"common-issues",level:3},{value:"Debug Mode",id:"debug-mode",level:3}];function o(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"s3-object-storage-gateway",children:"S3 Object Storage Gateway"})}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Curvine S3 Object Storage Gateway is a high-performance, enterprise-grade S3-compatible gateway that provides standard AWS S3 API access to the Curvine distributed file caching system. Through this gateway, users can access Curvine stored data using any S3 protocol-compatible tools and applications."}),"\n",(0,s.jsx)(n.h3,{id:"key-features",children:"Key Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Full S3 API Compatibility"}),": Supports all common S3 operations including object and bucket management"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"High-Performance Architecture"}),": Built with Rust and Axum for asynchronous high-throughput processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Enterprise Security"}),": Supports AWS Signature V2/V4 authentication with comprehensive access control"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Flexible Deployment"}),": Supports standalone deployment"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Streaming Operations"}),": Memory-efficient handling of large files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Range Requests"}),": Supports HTTP Range requests and partial content downloads"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multipart Upload"}),": Supports chunked uploads for large files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Load Balancing"}),": Supports multi-instance deployment for enhanced performance"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,s.jsx)(n.p,{children:"The S3 gateway serves as the frontend interface for the Curvine system, converting standard S3 API requests into Curvine filesystem operations:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Curvine S3 Gateway Architecture",src:i(5581).A+"",width:"600",height:"200"})}),"\n",(0,s.jsx)(n.h2,{id:"supported-s3-operations",children:"Supported S3 Operations"}),"\n",(0,s.jsx)(n.h3,{id:"object-operations",children:"Object Operations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"PutObject"})," - Upload objects"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GetObject"})," - Download objects"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"HeadObject"})," - Retrieve object metadata"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DeleteObject"})," - Delete objects"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CopyObject"})," - Copy objects (planned)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"bucket-operations",children:"Bucket Operations"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CreateBucket"})," - Create buckets"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DeleteBucket"})," - Delete buckets"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"HeadBucket"})," - Check bucket existence"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ListObjects"})," - List objects in bucket"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GetBucketLocation"})," - Get bucket location"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"advanced-features",children:"Advanced Features"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Range Requests"}),": Support HTTP Range headers for partial content downloads"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Multipart Upload"}),": Support chunked uploads for large files"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Streaming Transfer"}),": Memory-efficient large file transfers"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"service-management",children:"Service Management"}),"\n",(0,s.jsxs)(n.p,{children:["The S3 gateway provides convenient service management scripts located at ",(0,s.jsx)(n.code,{children:"build/bin/curvine-s3-gateway.sh"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"start-service",children:"Start Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Start with default configuration\n./build/bin/curvine-s3-gateway.sh start\n\n# Start with custom configuration file\n./build/bin/curvine-s3-gateway.sh start --conf /path/to/curvine-cluster.toml\n\n# Start with custom listen address and region\n./build/bin/curvine-s3-gateway.sh start \\\n    --listen 0.0.0.0:9000 \\\n    --region us-west-2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"stop-service",children:"Stop Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Gracefully stop service\n./build/bin/curvine-s3-gateway.sh stop\n"})}),"\n",(0,s.jsx)(n.h3,{id:"check-service-status",children:"Check Service Status"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check service running status\n./build/bin/curvine-s3-gateway.sh status\n"})}),"\n",(0,s.jsx)(n.h3,{id:"restart-service",children:"Restart Service"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Restart service\n./build/bin/curvine-s3-gateway.sh restart\n"})}),"\n",(0,s.jsx)(n.h3,{id:"view-logs",children:"View Logs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# View real-time logs\ntail -f ${CURVINE_HOME}/logs/curvine-s3-gateway.out\n\n# View recent logs\ntail -100 ${CURVINE_HOME}/logs/curvine-s3-gateway.out\n"})}),"\n",(0,s.jsx)(n.h2,{id:"startup-parameters",children:"Startup Parameters"}),"\n",(0,s.jsx)(n.h3,{id:"command-line-arguments",children:"Command Line Arguments"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Example"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--conf"})}),(0,s.jsx)(n.td,{children:"Configuration file path"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"${CURVINE_HOME}/conf/curvine-cluster.toml"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--conf /etc/curvine.toml"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--listen"})}),(0,s.jsx)(n.td,{children:"Listen address and port"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"0.0.0.0:9900"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--listen 127.0.0.1:9000"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--region"})}),(0,s.jsx)(n.td,{children:"S3 region identifier"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"us-east-1"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"--region us-west-2"})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"configuration-file-parameters",children:"Configuration File Parameters"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"[s3_gateway]"})," section in ",(0,s.jsx)(n.code,{children:"curvine-cluster.toml"})," supports the following configuration parameters:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Parameter"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"listen"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"0.0.0.0:9900"'})}),(0,s.jsx)(n.td,{children:"S3 gateway listen address and port"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"region"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"us-east-1"'})}),(0,s.jsx)(n.td,{children:"S3 region identifier"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"put_temp_dir"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:'"/tmp/curvine-temp"'})}),(0,s.jsx)(n.td,{children:"Temporary directory for all PUT operations (multipart and regular)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"put_memory_buffer_threshold"})}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1048576"})}),(0,s.jsx)(n.td,{children:"Memory buffer threshold for small files (bytes, default: 1MB)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"put_max_memory_buffer"})}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"16777216"})}),(0,s.jsx)(n.td,{children:"Maximum memory buffer size (bytes, default: 16MB)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"get_chunk_size_mb"})}),(0,s.jsx)(n.td,{children:"float"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1.0"})}),(0,s.jsx)(n.td,{children:"GET read/write chunk size in MB (default: 1.0, options: 0.5/1/2)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"enable_distributed_auth"})}),(0,s.jsx)(n.td,{children:"boolean"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})}),(0,s.jsx)(n.td,{children:"Enable distributed authentication"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"credentials_path"})}),(0,s.jsx)(n.td,{children:"string"}),(0,s.jsx)(n.td,{children:"See description"}),(0,s.jsx)(n.td,{children:"Credentials file path, depends on authentication mode"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"cache_refresh_interval_secs"})}),(0,s.jsx)(n.td,{children:"integer"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"30"})}),(0,s.jsx)(n.td,{children:"Cache refresh interval in seconds"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Credentials Path Description:"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"credentials_path"})," parameter value depends on the ",(0,s.jsx)(n.code,{children:"enable_distributed_auth"})," setting:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Local Authentication Mode"})," (",(0,s.jsx)(n.code,{children:"enable_distributed_auth = false"}),"):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Default path: ",(0,s.jsx)(n.code,{children:"~/.curvine/credentials.jsonl"})]}),"\n",(0,s.jsx)(n.li,{children:"Credentials stored in local filesystem"}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Distributed Authentication Mode"})," (",(0,s.jsx)(n.code,{children:"enable_distributed_auth = true"}),"):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Default path: ",(0,s.jsx)(n.code,{children:"/system/auth/credentials.jsonl"})]}),"\n",(0,s.jsx)(n.li,{children:"Credentials stored in Curvine distributed filesystem"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configuration Example:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[s3_gateway]\n# Listen address for S3 gateway (host:port)\nlisten = "0.0.0.0:9900"\n\n# S3 region\nregion = "us-east-1"\n\n# Temporary directory for all PUT operations (multipart and regular)\nput_temp_dir = "/tmp/curvine-temp"\n\n# Memory buffer threshold for small files (bytes, default: 1MB)\nput_memory_buffer_threshold = 1048576\n\n# Maximum memory buffer size (bytes, default: 16MB)\nput_max_memory_buffer = 16777216\n\n# GET Performance Optimization Settings\n# GET read/write chunk size in MB (default: 1.0, options: 0.5/1/2)\nget_chunk_size_mb = 1.0\n\n# Authentication mode configuration\n# Local authentication mode (default)\nenable_distributed_auth = false\ncredentials_path = "~/.curvine/credentials.jsonl"\n\n# Distributed authentication mode (optional)\n# enable_distributed_auth = true\n# credentials_path = "/system/auth/credentials.jsonl"\n\n# Cache refresh interval in seconds\ncache_refresh_interval_secs = 30\n'})}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Variable"}),(0,s.jsx)(n.th,{children:"Description"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"})," or ",(0,s.jsx)(n.code,{children:"S3_ACCESS_KEY"})]}),(0,s.jsx)(n.td,{children:"S3 access key"}),(0,s.jsx)(n.td,{children:"Read from environment variables at startup, no default value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"})," or ",(0,s.jsx)(n.code,{children:"S3_SECRET_KEY"})]}),(0,s.jsx)(n.td,{children:"S3 secret key"}),(0,s.jsx)(n.td,{children:"Read from environment variables at startup, no default value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RUST_LOG"})}),(0,s.jsx)(n.td,{children:"Log level"}),(0,s.jsxs)(n.td,{children:["Default ",(0,s.jsx)(n.code,{children:"info"}),", can be set to ",(0,s.jsx)(n.code,{children:"debug"}),", ",(0,s.jsx)(n.code,{children:"trace"}),", etc."]})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Credential Environment Variables:"})}),"\n",(0,s.jsx)(n.p,{children:"The gateway automatically reads the following environment variables as default credentials at startup:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Set access key (choose either one)\nexport AWS_ACCESS_KEY_ID="your-access-key"\n# or\nexport S3_ACCESS_KEY="your-access-key"\n\n# Set secret key (choose either one)\nexport AWS_SECRET_ACCESS_KEY="your-secret-key"\n# or\nexport S3_SECRET_KEY="your-secret-key"\n'})}),"\n",(0,s.jsx)(n.p,{children:"If these environment variables are set, the gateway will automatically add these credentials to the credential store at startup, without manual configuration."}),"\n",(0,s.jsx)(n.h2,{id:"credential-management",children:"Credential Management"}),"\n",(0,s.jsx)(n.p,{children:"The S3 gateway provides comprehensive credential management functionality, supporting adding, generating, listing, and managing access credentials."}),"\n",(0,s.jsx)(n.h3,{id:"add-credentials",children:"Add Credentials"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Add new access credentials\n./build/bin/curvine-s3-gateway.sh credential add \\\n    --access-key AKIAEXAMPLEKEY123 \\\n    --secret-key wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY \\\n    --description "Production access key"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"generate-random-credentials",children:"Generate Random Credentials"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Generate new random credentials\n./build/bin/curvine-s3-gateway.sh credential generate \\\n    --description "Auto-generated test key"\n'})}),"\n",(0,s.jsx)(n.h3,{id:"list-credentials",children:"List Credentials"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# List all credentials (secrets hidden)\n./build/bin/curvine-s3-gateway.sh credential list\n\n# Show complete credential information (including secrets)\n./build/bin/curvine-s3-gateway.sh credential list --show-secrets\n"})}),"\n",(0,s.jsx)(n.h3,{id:"view-cache-statistics",children:"View Cache Statistics"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# View credential cache statistics\n./build/bin/curvine-s3-gateway.sh credential stats\n"})}),"\n",(0,s.jsx)(n.h3,{id:"credential-storage",children:"Credential Storage"}),"\n",(0,s.jsx)(n.p,{children:"Credentials are stored in JSONL format:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Local mode"}),": ",(0,s.jsx)(n.code,{children:"~/.curvine/credentials.jsonl"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Distributed mode"}),": ",(0,s.jsx)(n.code,{children:"/system/auth/credentials.jsonl"})]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Each credential entry contains:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "access_key": "AKIAEXAMPLEKEY123",\n  "secret_key": "wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY",\n  "created_at": 1640995200,\n  "enabled": true,\n  "description": "Production access key"\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,s.jsx)(n.h3,{id:"aws-cli",children:"AWS CLI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Configure environment variables\nexport AWS_ACCESS_KEY_ID=AqU4axe4feDyIielarPI\nexport AWS_SECRET_ACCESS_KEY=0CJZ2QfHi2tDb4DKuCJ2vnBEUXg5EYQt\nexport AWS_DEFAULT_REGION=us-east-1\n\n# Create bucket\naws s3 mb s3://my-bucket --endpoint-url http://localhost:9900\n\n# Upload file\naws s3 cp /path/to/local/file.txt s3://my-bucket/ --endpoint-url http://localhost:9900\n\n# Download file\naws s3 cp s3://my-bucket/file.txt /tmp/ --endpoint-url http://localhost:9900\n\n# List objects\naws s3 ls s3://my-bucket/ --endpoint-url http://localhost:9900\n\n# Delete object\naws s3 rm s3://my-bucket/file.txt --endpoint-url http://localhost:9900\n\n# Sync directory\naws s3 sync /local/directory s3://my-bucket/prefix/ --endpoint-url http://localhost:9900\n"})}),"\n",(0,s.jsx)(n.h3,{id:"minio-client-mc",children:"MinIO Client (mc)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Configure MinIO client\nmc alias set curvine http://localhost:9900 AqU4axe4feDyIielarPI 0CJZ2QfHi2tDb4DKuCJ2vnBEUXg5EYQt\n\n# Create bucket\nmc mb curvine/my-bucket\n\n# Upload file\nmc cp /path/to/file.txt curvine/my-bucket/\n\n# Download file\nmc cp curvine/my-bucket/file.txt /tmp/\n\n# List contents\nmc ls curvine/my-bucket/\n\n# Mirror directory\nmc mirror /local/directory curvine/my-bucket/prefix/\n"})}),"\n",(0,s.jsx)(n.h3,{id:"python-boto3",children:"Python boto3"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"import boto3\nfrom botocore.config import Config\n\n# Create S3 client\ns3_client = boto3.client(\n    's3',\n    endpoint_url='http://localhost:9900',\n    aws_access_key_id='AqU4axe4feDyIielarPI',\n    aws_secret_access_key='0CJZ2QfHi2tDb4DKuCJ2vnBEUXg5EYQt',\n    region_name='us-east-1',\n    config=Config(retries={'max_attempts': 3})\n)\n\n# Create bucket\ns3_client.create_bucket(Bucket='my-python-bucket')\n\n# Upload file\nwith open('local-file.txt', 'rb') as f:\n    s3_client.put_object(Bucket='my-python-bucket', Key='remote-file.txt', Body=f)\n\n# Download file\nresponse = s3_client.get_object(Bucket='my-python-bucket', Key='remote-file.txt')\ndata = response['Body'].read()\n\n# List objects\nresponse = s3_client.list_objects_v2(Bucket='my-python-bucket')\nfor obj in response.get('Contents', []):\n    print(f\"Object: {obj['Key']}, Size: {obj['Size']}\")\n"})}),"\n",(0,s.jsx)(n.h3,{id:"range-request-examples",children:"Range Request Examples"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# Get first 1000 bytes of a file\ncurl -H "Range: bytes=0-999" \\\n     -H "Authorization: AWS4-HMAC-SHA256 ..." \\\n     http://localhost:9900/my-bucket/large-file.txt\n\n# Get last 1000 bytes of a file\ncurl -H "Range: bytes=-1000" \\\n     -H "Authorization: AWS4-HMAC-SHA256 ..." \\\n     http://localhost:9900/my-bucket/large-file.txt\n'})}),"\n",(0,s.jsx)(n.h2,{id:"multi-instance-deployment",children:"Multi-Instance Deployment"}),"\n",(0,s.jsx)(n.p,{children:"To improve performance and availability, you can deploy multiple S3 gateway instances."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Currently, the S3 gateway uses a centralized deployment model. The decentralized gateway capability that starts with Worker nodes is under development and will support a more distributed deployment architecture in the future."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"load-balancer-configuration",children:"Load Balancer Configuration"}),"\n",(0,s.jsx)(n.h4,{id:"using-nginx",children:"Using Nginx"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:"upstream s3_gateway {\n    server 192.168.1.10:9900 weight=1;\n    server 192.168.1.11:9900 weight=1;\n    server 192.168.1.12:9900 weight=1;\n}\n\nserver {\n    listen 80;\n    server_name s3-gateway.example.com;\n    \n    location / {\n        proxy_pass http://s3_gateway;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        \n        # S3-specific configuration\n        proxy_buffering off;\n        proxy_request_buffering off;\n        client_max_body_size 0;\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"using-haproxy",children:"Using HAProxy"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-haproxy",children:"backend s3_gateway\n    balance roundrobin\n    option httpchk GET /healthz\n    server gateway1 192.168.1.10:9900 check\n    server gateway2 192.168.1.11:9900 check\n    server gateway3 192.168.1.12:9900 check\n\nfrontend s3_frontend\n    bind *:80\n    default_backend s3_gateway\n"})}),"\n",(0,s.jsx)(n.h3,{id:"multi-instance-startup",children:"Multi-Instance Startup"}),"\n",(0,s.jsx)(n.p,{children:"Start gateway instances on each node:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Node 1\n./build/bin/curvine-s3-gateway.sh start \\\n    --conf /etc/curvine-cluster.toml \\\n    --listen 0.0.0.0:9900\n\n# Node 2  \n./build/bin/curvine-s3-gateway.sh start \\\n    --conf /etc/curvine-cluster.toml \\\n    --listen 0.0.0.0:9900\n\n# Node 3\n./build/bin/curvine-s3-gateway.sh start \\\n    --conf /etc/curvine-cluster.toml \\\n    --listen 0.0.0.0:9900\n"})}),"\n",(0,s.jsx)(n.h3,{id:"high-availability-configuration",children:"High Availability Configuration"}),"\n",(0,s.jsx)(n.h4,{id:"configure-shared-storage",children:"Configure Shared Storage"}),"\n",(0,s.jsx)(n.p,{children:"Ensure all gateway instances use the same Curvine cluster configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[s3_gateway]\n# Use distributed authentication for credential consistency\nenable_distributed_auth = true\ncredentials_path = "/system/auth/credentials.jsonl"\n\n# Shared multipart upload directory\nmultipart_temp = "/shared/curvine-multipart"\n'})}),"\n",(0,s.jsx)(n.h4,{id:"health-checks",children:"Health Checks"}),"\n",(0,s.jsx)(n.p,{children:"Each gateway instance provides a health check endpoint:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check gateway health\ncurl http://localhost:9900/healthz\n"})}),"\n",(0,s.jsx)(n.h3,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,s.jsx)(n.h4,{id:"system-level-optimization",children:"System-Level Optimization"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Increase file descriptor limits\nulimit -n 65536\n\n# Optimize network parameters\necho 'net.ipv4.tcp_keepalive_time = 600' >> /etc/sysctl.conf\necho 'net.core.rmem_max = 16777216' >> /etc/sysctl.conf\necho 'net.core.wmem_max = 16777216' >> /etc/sysctl.conf\nsysctl -p\n"})}),"\n",(0,s.jsx)(n.h4,{id:"configuration-tuning",children:"Configuration Tuning"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:"[s3_gateway]\n# Optimize cache refresh interval\ncache_refresh_interval_secs = 60\n"})}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"common-issues",children:"Common Issues"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Port Already in Use"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Change listen port\n./build/bin/curvine-s3-gateway.sh start --listen 0.0.0.0:9901\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Authentication Failures"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Check environment variables\necho $AWS_ACCESS_KEY_ID\necho $AWS_SECRET_ACCESS_KEY\n\n# Check if credentials exist in credential store\n./build/bin/curvine-s3-gateway.sh credential list\n\n# View credential store path and statistics\n./build/bin/curvine-s3-gateway.sh credential stats\n\n# View authentication logs\nexport RUST_LOG=curvine_s3_gateway::auth=debug\n"})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Configuration File Errors"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Validate configuration file\n./build/bin/curvine-s3-gateway.sh start --conf /path/to/config.toml\n\n# Use default configuration\n./build/bin/curvine-s3-gateway.sh start\n"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"debug-mode",children:"Debug Mode"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Enable verbose logging\nexport RUST_LOG=debug\n./build/bin/curvine-s3-gateway.sh start\n\n# Enable trace level logging\nexport RUST_LOG=trace\n./build/bin/curvine-s3-gateway.sh start\n"})}),"\n",(0,s.jsx)(n.p,{children:"With these configurations and optimizations, you can build an efficient S3 gateway to access data cached in Curvine."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);