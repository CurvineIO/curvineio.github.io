"use strict";(self.webpackChunkcurvine_doc=self.webpackChunkcurvine_doc||[]).push([[7263],{520:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"User-Manuals/K8S-CSI-Driver/Framework","title":"Curvine CSI Architecture","description":"curvine-csi is based on FUSE implementation, establishing connection with Curvine cluster through FUSE mount in csi-node.","source":"@site/docs/3-User-Manuals/5-K8S-CSI-Driver/04-Framework.md","sourceDirName":"3-User-Manuals/5-K8S-CSI-Driver","slug":"/User-Manuals/K8S-CSI-Driver/Framework","permalink":"/docs/User-Manuals/K8S-CSI-Driver/Framework","draft":false,"unlisted":false,"editUrl":"https://github.com/curvineio/curvine-doc/edit/main/docs/3-User-Manuals/5-K8S-CSI-Driver/04-Framework.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Using Dynamic PV in StatefulSet","permalink":"/docs/User-Manuals/K8S-CSI-Driver/StatefulSet"},"next":{"title":"Benchmark","permalink":"/docs/category/benchmark"}}');var t=s(4848),l=s(8453);const o={},i="Curvine CSI Architecture",a={},d=[{value:"Architecture",id:"architecture",level:2},{value:"Mount Modes",id:"mount-modes",level:2},{value:"Standalone Mode (Recommended)",id:"standalone-mode-recommended",level:3},{value:"Resource Configuration",id:"resource-configuration",level:4},{value:"Embedded Mode",id:"embedded-mode",level:3},{value:"FUSE Process Reuse and Lifecycle Management",id:"fuse-process-reuse-and-lifecycle-management",level:2},{value:"Overview",id:"overview",level:3},{value:"Core Concepts",id:"core-concepts",level:3},{value:"ClusterID Generation",id:"clusterid-generation",level:4},{value:"Standalone Pod Naming",id:"standalone-pod-naming",level:4},{value:"FUSE Process Reuse Mechanism",id:"fuse-process-reuse-mechanism",level:3},{value:"Reuse Scenario Example",id:"reuse-scenario-example",level:4},{value:"RBAC Requirements",id:"rbac-requirements",level:3},{value:"Best Practices",id:"best-practices",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"curvine-csi-architecture",children:"Curvine CSI Architecture"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"curvine-csi"})," is based on FUSE implementation, establishing connection with Curvine cluster through FUSE mount in csi-node."]}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"If you only need to use CSI, you can skip this chapter"})," and refer to ",(0,t.jsx)(n.a,{href:"Setup",children:"K8S CSI Driver"})," directly."]}),"\n",(0,t.jsx)(n.p,{children:"Curvine-csi mainly consists of the following components:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Component"}),(0,t.jsx)(n.th,{children:"Responsibility"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CSI Node"}),(0,t.jsx)(n.td,{children:"Handle CSI gRPC calls, manage volume mounts"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CSI Controller"}),(0,t.jsx)(n.td,{children:"Create/Delete/Monitor PVs"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Standalone POD"}),(0,t.jsxs)(n.td,{children:["In ",(0,t.jsx)(n.code,{children:"standalone"})," mode, independently manages FUSE processes"]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"mount-modes",children:"Mount Modes"}),"\n",(0,t.jsxs)(n.p,{children:["Most CSI implementations manage mounts directly in ",(0,t.jsx)(n.code,{children:"csi-node"})," by mounting remote storage to hosts and finally bind mounting to pod containers. Curvine-csi is based on FUSE. When the CSI component restarts, the FUSE process will be interrupted. To avoid FUSE interruption caused by CSI driver upgrades or restarts, curvine-csi supports two mount modes: standalone and embedded."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Standalone"}),": Decouple the FUSE process from the csi-node pod and run it in an independent Pod"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Embedded"}),": FUSE process runs in the csi-node plugin pod"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"standalone-mode-recommended",children:"Standalone Mode (Recommended)"}),"\n",(0,t.jsx)(n.p,{children:"Default mode. Install with Helm:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install curvine-csi ./curvine-csi \\\n  --set mountMode=standalone\n"})}),"\n",(0,t.jsx)(n.h4,{id:"resource-configuration",children:"Resource Configuration"}),"\n",(0,t.jsx)(n.p,{children:"Configure Standalone Pod resource limits via Helm values:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install curvine-csi ./curvine-csi \\\n  --set node.mountMode=standalone \\\n  --set node.standalone.resources.requests.cpu=500m \\\n  --set node.standalone.resources.requests.memory=512Mi \\\n  --set node.standalone.resources.limits.cpu=2 \\\n  --set node.standalone.resources.limits.memory=2Gi\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or use a values file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'node:\n  mountMode: standalone\n  standalone:\n    image: ""  # Empty uses CSI image\n    resources:\n      requests:\n        cpu: "500m"\n        memory: "512Mi"\n      limits:\n        cpu: "2"\n        memory: "2Gi"\n'})}),"\n",(0,t.jsx)(n.p,{children:"Default configuration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"CPU: requests 500m, limits 2"}),"\n",(0,t.jsx)(n.li,{children:"Memory: requests 512Mi, limits 2Gi"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Architecture diagram:"}),"\n",(0,t.jsx)(n.mermaid,{value:'%%{init: {\'theme\': \'base\', \'themeVariables\': { \'background\': \'#ffffff\', \'primaryColor\': \'#4a9eff\', \'primaryTextColor\': \'#1a202c\', \'primaryBorderColor\': \'#3182ce\', \'lineColor\': \'#4a5568\', \'secondaryColor\': \'#805ad5\', \'tertiaryColor\': \'#38a169\', \'mainBkg\': \'#ffffff\', \'nodeBorder\': \'#4a5568\', \'clusterBkg\': \'#f8f9fa\', \'clusterBorder\': \'#dee2e6\', \'titleColor\': \'#1a202c\'}}}%%flowchart TB\n    subgraph K8sNode["Kubernetes Node"]\n        subgraph CSIPod["CSI Node Pod"]\n            CSIDriver["CSI Driver<br/>gRPC Handler"]\n            MountPodCtrl["MountPod<br/>Controller"]\n        end\n        \n        subgraph MountPods["MountPod Layer"]\n            subgraph MP1["MountPod-1 (privileged)"]\n                FUSE1["curvine-fuse<br/>Process"]\n                MNT1["/mnt/curvine/<br/>cluster-A"]\n            end\n            \n            subgraph MP2["MountPod-2 (privileged)"]\n                FUSE2["curvine-fuse<br/>Process"]\n                MNT2["/mnt/curvine/<br/>cluster-B"]\n            end\n        end\n        \n        subgraph HostFS["Host Filesystem"]\n            PluginPath["/var/lib/kubelet/plugins/curvine/"]\n            ClusterA["cluster-A/fuse-mount/"]\n            ClusterB["cluster-B/fuse-mount/"]\n        end\n        \n        subgraph AppPods["Application Pods"]\n            App1["App Pod 1"]\n            App2["App Pod 2"]\n            VolPath1["/var/lib/kubelet/pods/xxx/<br/>volumes/.../mount"]\n            VolPath2["/var/lib/kubelet/pods/yyy/<br/>volumes/.../mount"]\n        end\n        \n        subgraph External["Curvine Cluster"]\n            CurvineClusterA[("Curvine<br/>Cluster A")]\n            CurvineClusterB[("Curvine<br/>Cluster B")]\n        end\n    end\n    \n    %% CSI Pod manages MountPods\n    CSIDriver --\x3e MountPodCtrl\n    MountPodCtrl --\x3e|"Create/Delete"| MP1\n    MountPodCtrl --\x3e|"Create/Delete"| MP2\n    \n    %% FUSE processes connect to clusters\n    FUSE1 -.->|"gRPC"| CurvineClusterA\n    FUSE2 -.->|"gRPC"| CurvineClusterB\n    \n    %% FUSE mounts to host paths\n    FUSE1 --\x3e MNT1\n    MNT1 --\x3e|"Bidirectional<br/>Mount Propagation"| ClusterA\n    \n    FUSE2 --\x3e MNT2\n    MNT2 --\x3e|"Bidirectional<br/>Mount Propagation"| ClusterB\n    \n    %% Host paths organization\n    PluginPath --\x3e ClusterA\n    PluginPath --\x3e ClusterB\n    \n    %% App pods bind mount\n    ClusterA --\x3e|"bind mount<br/>+ subpath"| VolPath1\n    ClusterB --\x3e|"bind mount<br/>+ subpath"| VolPath2\n    \n    VolPath1 --\x3e App1\n    VolPath2 --\x3e App2\n\n    %% Styles - colors adjusted for light background\n    classDef csiStyle fill:#4a9eff,stroke:#2b6cb0,color:#fff,stroke-width:2px\n    classDef mountPodStyle fill:#805ad5,stroke:#553c9a,color:#fff,stroke-width:2px\n    classDef fuseStyle fill:#ecc94b,stroke:#b7791f,color:#1a202c,stroke-width:2px\n    classDef hostStyle fill:#48bb78,stroke:#276749,color:#fff,stroke-width:2px\n    classDef appStyle fill:#ed8936,stroke:#c05621,color:#fff,stroke-width:2px\n    classDef storageStyle fill:#fc8181,stroke:#c53030,color:#1a202c,stroke-width:2px\n    classDef pathStyle fill:#cbd5e0,stroke:#718096,color:#1a202c,stroke-width:1px\n    \n    class CSIDriver,MountPodCtrl csiStyle\n    class MP1,MP2 mountPodStyle\n    class FUSE1,FUSE2 fuseStyle\n    class PluginPath,ClusterA,ClusterB hostStyle\n    class App1,App2 appStyle\n    class CurvineClusterA,CurvineClusterB storageStyle\n    class MNT1,MNT2,VolPath1,VolPath2 pathStyle'}),"\n",(0,t.jsx)(n.h3,{id:"embedded-mode",children:"Embedded Mode"}),"\n",(0,t.jsx)(n.p,{children:"Install with Helm:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm install curvine-csi ./curvine-csi \\\n  --set node.mountMode=embedded \\\n  --set node.resources.requests.memory=2Gi \\\n  --set node.resources.requests.cpu=1000m \\\n  --set node.resources.limits.memory=4Gi \\\n  --set node.resources.limits.cpu=2000m\n"})}),"\n",(0,t.jsx)(n.p,{children:"Architecture diagram:"}),"\n",(0,t.jsx)(n.mermaid,{value:"%%{init: {'theme': 'base', 'themeVariables': { 'background': '#ffffff', 'primaryColor': '#4a9eff', 'primaryTextColor': '#1a202c', 'primaryBorderColor': '#3182ce', 'lineColor': '#4a5568', 'secondaryColor': '#805ad5', 'tertiaryColor': '#38a169', 'mainBkg': '#ffffff', 'nodeBorder': '#4a5568', 'clusterBkg': '#f8f9fa', 'clusterBorder': '#dee2e6', 'titleColor': '#1a202c'}}}%%flowchart TB\n    subgraph K8sNode[\"Kubernetes Node\"]\n        subgraph CSIPod[\"CSI Node Pod (privileged)\"]\n            CSIDriver[\"CSI Driver<br/>gRPC Handler\"]\n            FUSE1[\"curvine-fuse<br/>Process\"]\n            FUSE2[\"curvine-fuse<br/>Process\"]\n            MNT1[\"/mnt/curvine/<br/>cluster-A\"]\n            MNT2[\"/mnt/curvine/<br/>cluster-B\"]\n        end\n        \n        subgraph HostFS[\"Host Filesystem\"]\n            PluginPath[\"/var/lib/kubelet/plugins/curvine/\"]\n            ClusterA[\"cluster-A/fuse-mount/\"]\n            ClusterB[\"cluster-B/fuse-mount/\"]\n        end\n        \n        subgraph AppPods[\"Application Pods\"]\n            App1[\"App Pod 1\"]\n            App2[\"App Pod 2\"]\n            VolPath1[\"/var/lib/kubelet/pods/xxx/<br/>volumes/.../mount\"]\n            VolPath2[\"/var/lib/kubelet/pods/yyy/<br/>volumes/.../mount\"]\n        end\n        \n        subgraph External[\"Curvine Cluster\"]\n            CurvineClusterA[(\"Curvine<br/>Cluster A\")]\n            CurvineClusterB[(\"Curvine<br/>Cluster B\")]\n        end\n    end\n    \n    %% FUSE processes connect to clusters\n    FUSE1 -.->|\"gRPC\"| CurvineClusterA\n    FUSE2 -.->|\"gRPC\"| CurvineClusterB\n    \n    %% FUSE mounts to host paths\n    FUSE1 --\x3e MNT1\n    MNT1 --\x3e|\"Bidirectional<br/>Mount Propagation\"| ClusterA\n    \n    FUSE2 --\x3e MNT2\n    MNT2 --\x3e|\"Bidirectional<br/>Mount Propagation\"| ClusterB\n    \n    %% Host paths organization\n    PluginPath --\x3e ClusterA\n    PluginPath --\x3e ClusterB\n    \n    %% App pods bind mount\n    ClusterA --\x3e|\"bind mount<br/>+ subpath\"| VolPath1\n    ClusterB --\x3e|\"bind mount<br/>+ subpath\"| VolPath2\n    \n    VolPath1 --\x3e App1\n    VolPath2 --\x3e App2\n\n    %% Styles\n    classDef csiStyle fill:#4a9eff,stroke:#2b6cb0,color:#fff,stroke-width:2px\n    classDef fuseStyle fill:#ecc94b,stroke:#b7791f,color:#1a202c,stroke-width:2px\n    classDef hostStyle fill:#48bb78,stroke:#276749,color:#fff,stroke-width:2px\n    classDef appStyle fill:#ed8936,stroke:#c05621,color:#fff,stroke-width:2px\n    classDef storageStyle fill:#fc8181,stroke:#c53030,color:#1a202c,stroke-width:2px\n    classDef pathStyle fill:#cbd5e0,stroke:#718096,color:#1a202c,stroke-width:1px\n    \n    class CSIDriver,FUSE1,FUSE2 csiStyle\n    class PluginPath,ClusterA,ClusterB hostStyle\n    class App1,App2 appStyle\n    class CurvineClusterA,CurvineClusterB storageStyle\n    class MNT1,MNT2,VolPath1,VolPath2 pathStyle"}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"In Embedded mode, if curvine-csi restarts or upgrades, the FUSE process will be interrupted, causing Pods to be unable to use Curvine normally. Please choose carefully based on your scenario."})}),"\n",(0,t.jsx)(n.h2,{id:"fuse-process-reuse-and-lifecycle-management",children:"FUSE Process Reuse and Lifecycle Management"}),"\n",(0,t.jsx)(n.h3,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["Curvine CSI implements intelligent FUSE process reuse mechanism. Using ",(0,t.jsx)(n.strong,{children:"ClusterID"})," as a unique identifier, multiple PVs can share the same FUSE process (Standalone Pod). This design significantly improves resource utilization and system performance."]}),"\n",(0,t.jsx)(n.h3,{id:"core-concepts",children:"Core Concepts"}),"\n",(0,t.jsx)(n.h4,{id:"clusterid-generation",children:"ClusterID Generation"}),"\n",(0,t.jsxs)(n.p,{children:["ClusterID is generated from the first 8 characters of the SHA256 hash of ",(0,t.jsx)(n.code,{children:"master-addrs"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'// Example: Generate ClusterID from master-addrs\nmasterAddrs := "10.0.0.1:8995,10.0.0.2:8995,10.0.0.3:8995"\nclusterID := SHA256(masterAddrs)[:8]  // e.g., 0893a5f6\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Key Features"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Same ",(0,t.jsx)(n.code,{children:"master-addrs"})," \u2192 Same ClusterID \u2192 Shared Standalone Pod"]}),"\n",(0,t.jsxs)(n.li,{children:["Different ",(0,t.jsx)(n.code,{children:"master-addrs"})," \u2192 Different ClusterID \u2192 Independent Standalone Pod"]}),"\n",(0,t.jsx)(n.li,{children:"Multi-cluster support: Same node can run multiple Standalone Pods for different Curvine clusters"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"standalone-pod-naming",children:"Standalone Pod Naming"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curvine-standalone-{clusterID}-{randomSuffix}\n# Example: curvine-standalone-0893a5f6-aefd8804\n"})}),"\n",(0,t.jsx)(n.h3,{id:"fuse-process-reuse-mechanism",children:"FUSE Process Reuse Mechanism"}),"\n",(0,t.jsx)(n.h4,{id:"reuse-scenario-example",children:"Reuse Scenario Example"}),"\n",(0,t.jsx)(n.mermaid,{value:"%%{init: {'theme': 'base', 'themeVariables': { 'background': '#ffffff', 'primaryColor': '#4a9eff', 'primaryTextColor': '#1a202c', 'primaryBorderColor': '#3182ce', 'lineColor': '#4a5568', 'secondaryColor': '#805ad5', 'tertiaryColor': '#38a169', 'mainBkg': '#ffffff', 'nodeBorder': '#4a5568', 'clusterBkg': '#f8f9fa', 'clusterBorder': '#dee2e6', 'titleColor': '#1a202c'}}}%%\nflowchart LR\n    subgraph PVs[\"PersistentVolumes\"]\n        PV1[\"PV-1<br/>volumeHandle: vol-app1<br/>master-addrs: 10.0.0.1:8995,...\"]\n        PV2[\"PV-2<br/>volumeHandle: vol-app2<br/>master-addrs: 10.0.0.1:8995,...\"]\n        PV3[\"PV-3<br/>volumeHandle: vol-db<br/>master-addrs: 10.0.0.1:8995,...\"]\n        PV4[\"PV-4<br/>volumeHandle: vol-logs<br/>master-addrs: 192.168.1.1:8995,...\"]\n    end\n    \n    subgraph ClusterID[\"ClusterID Calculation\"]\n        Hash1[\"SHA256(10.0.0.1:8995,...)<br/>\u2192 0893a5f6\"]\n        Hash2[\"SHA256(192.168.1.1:8995,...)<br/>\u2192 1a2b3c4d\"]\n    end\n    \n    subgraph Standalone[\"Standalone Pods\"]\n        SP1[\"Standalone-0893a5f6<br/>RefCount: 3<br/>Volumes: [vol-app1, vol-app2, vol-db]\"]\n        SP2[\"Standalone-1a2b3c4d<br/>RefCount: 1<br/>Volumes: [vol-logs]\"]\n    end\n    \n    PV1 --\x3e Hash1\n    PV2 --\x3e Hash1\n    PV3 --\x3e Hash1\n    PV4 --\x3e Hash2\n    \n    Hash1 --\x3e SP1\n    Hash2 --\x3e SP2\n    \n    classDef pvStyle fill:#4a9eff,stroke:#2b6cb0,color:#fff,stroke-width:2px\n    classDef hashStyle fill:#ecc94b,stroke:#b7791f,color:#1a202c,stroke-width:2px\n    classDef standaloneLightStyle fill:#805ad5,stroke:#553c9a,color:#fff,stroke-width:3px\n    classDef standaloneHeavyStyle fill:#e53e3e,stroke:#c53030,color:#fff,stroke-width:3px\n    \n    class PV1,PV2,PV3,PV4 pvStyle\n    class Hash1,Hash2 hashStyle\n    class SP1 standaloneHeavyStyle\n    class SP2 standaloneLightStyle"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Explanation"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["PV-1, PV-2, PV-3 use the same ",(0,t.jsx)(n.code,{children:"master-addrs"}),", sharing ",(0,t.jsx)(n.strong,{children:"Standalone-0893a5f6"})]}),"\n",(0,t.jsxs)(n.li,{children:["PV-4 uses different ",(0,t.jsx)(n.code,{children:"master-addrs"}),", using independent ",(0,t.jsx)(n.strong,{children:"Standalone-1a2b3c4d"})]}),"\n",(0,t.jsx)(n.li,{children:"Standalone-0893a5f6 has a reference count of 3 (three PVs sharing)"}),"\n",(0,t.jsx)(n.li,{children:"Standalone-1a2b3c4d has a reference count of 1"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Automatic Cleanup Mechanism"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Trigger Condition"}),": RefCount drops to 0 (no PV references)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Graceful Shutdown"}),": 30-second grace period to ensure FUSE unmounts correctly"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"preStop Hook"}),": 5-second wait to allow ongoing I/O to complete"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"State Persistence"}),": Reference counts stored in ConfigMap, state restored after node restarts"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"rbac-requirements",children:"RBAC Requirements"}),"\n",(0,t.jsx)(n.p,{children:"Standalone mode requires the following permissions:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Resource"}),(0,t.jsx)(n.th,{children:"Permissions"}),(0,t.jsx)(n.th,{children:"Purpose"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"pods"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"create"}),", ",(0,t.jsx)(n.code,{children:"delete"}),", ",(0,t.jsx)(n.code,{children:"get"}),", ",(0,t.jsx)(n.code,{children:"list"}),", ",(0,t.jsx)(n.code,{children:"watch"})]}),(0,t.jsx)(n.td,{children:"Manage Standalone Pods"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"configmaps"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"create"}),", ",(0,t.jsx)(n.code,{children:"delete"}),", ",(0,t.jsx)(n.code,{children:"get"}),", ",(0,t.jsx)(n.code,{children:"list"}),", ",(0,t.jsx)(n.code,{children:"update"}),", ",(0,t.jsx)(n.code,{children:"watch"})]}),(0,t.jsx)(n.td,{children:"State persistence"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"persistentvolumes"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"get"}),", ",(0,t.jsx)(n.code,{children:"list"}),", ",(0,t.jsx)(n.code,{children:"watch"})]}),(0,t.jsx)(n.td,{children:"PV Watch fallback cleanup"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"events"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"create"}),", ",(0,t.jsx)(n.code,{children:"patch"})]}),(0,t.jsx)(n.td,{children:"Event logging and debugging"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Use Standalone Mode"})," (default, recommended)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Independent FUSE process, CSI upgrades don't affect business"}),"\n",(0,t.jsx)(n.li,{children:"Resource isolation, clear problem domain"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Use consistent master-addrs for same cluster"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ensure PV's ",(0,t.jsx)(n.code,{children:"master-addrs"})," format is consistent"]}),"\n",(0,t.jsx)(n.li,{children:"Maximize FUSE process reuse"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Monitor Standalone Pods"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View all Standalone Pods\nkubectl get pods -n curvine-system -l app=curvine-standalone\n\n# View reference count state\nkubectl get configmap -n curvine-system -l app=curvine-standalone-state\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Check logs for lifecycle events"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-log",children:"# Creation\nI1222 10:00:00 Creating Standalone for cluster 0893a5f6\n\n# Reference addition\nI1222 10:01:00 Added volume ref, refCount=2\n\n# Automatic cleanup\nI1222 10:15:00 Removed volume ref, refCount=0\nI1222 10:15:00 No more refs, deleting Standalone\n"})}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>i});var r=s(6540);const t={},l=r.createContext(t);function o(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);