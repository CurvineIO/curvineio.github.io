"use strict";(self.webpackChunkcurvine_doc=self.webpackChunkcurvine_doc||[]).push([[7307],{6504:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"Deploy/deploy","title":"Deploy Curvine Cluster","description":"Curvine has excellent cross-platform capabilities and supports running on various operating systems across almost all mainstream architectures, including but not limited to Linux, macOS, Windows, etc. It supports different CPU architectures such as arm64, x86_64, etc.","source":"@site/docs/2-Deploy/02-deploy.md","sourceDirName":"2-Deploy","slug":"/Deploy/deploy","permalink":"/docs/Deploy/deploy","draft":false,"unlisted":false,"editUrl":"https://github.com/curvineio/curvine-doc/edit/main/docs/2-Deploy/02-deploy.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Quick Start","permalink":"/docs/Deploy/quick-start"},"next":{"title":"Environment Initialization","permalink":"/docs/Deploy/prerequisites"}}');var t=r(4848),s=r(8453);const o={sidebar_position:1},l="Deploy Curvine Cluster",a={},c=[{value:"Resource Requirements",id:"resource-requirements",level:3},{value:"Deployment",id:"deployment",level:2},{value:"Build From Source",id:"build-from-source",level:3},{value:"Configuration File Modification",id:"configuration-file-modification",level:3},{value:"Non-Container Deployment",id:"non-container-deployment",level:3},{value:"Container Deployment",id:"container-deployment",level:3},{value:"Kubernetes Deployment",id:"kubernetes-deployment",level:3},{value:"Metrics Collection",id:"metrics-collection",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"deploy-curvine-cluster",children:"Deploy Curvine Cluster"})}),"\n",(0,t.jsx)(n.p,{children:"Curvine has excellent cross-platform capabilities and supports running on various operating systems across almost all mainstream architectures, including but not limited to Linux, macOS, Windows, etc. It supports different CPU architectures such as arm64, x86_64, etc."}),"\n",(0,t.jsx)(n.p,{children:"Here are the recommended operating system versions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Linux: ",(0,t.jsx)(n.code,{children:"Rocky"})," >= 9, ",(0,t.jsx)(n.code,{children:"CentOS"})," >= 7, ",(0,t.jsx)(n.code,{children:"Ubuntu"})," > 22.04"]}),"\n",(0,t.jsx)(n.li,{children:"macOS"}),"\n",(0,t.jsx)(n.li,{children:"Windows"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Supported Distributions"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Operating System"}),(0,t.jsx)(n.th,{children:"Kernel Requirement"}),(0,t.jsx)(n.th,{children:"Tested Version"}),(0,t.jsx)(n.th,{children:"Dependencies"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CentOS 7"}),(0,t.jsx)(n.td,{children:"\u22653.10.0"}),(0,t.jsx)(n.td,{children:"7.6"}),(0,t.jsx)(n.td,{children:"fuse2-2.9.2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"CentOS 8"}),(0,t.jsx)(n.td,{children:"\u22654.18.0"}),(0,t.jsx)(n.td,{children:"8.5"}),(0,t.jsx)(n.td,{children:"fuse3-3.9.1"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Rocky Linux 9"}),(0,t.jsx)(n.td,{children:"\u22655.14.0"}),(0,t.jsx)(n.td,{children:"9.5"}),(0,t.jsx)(n.td,{children:"fuse3-3.10.2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"RHEL 9"}),(0,t.jsx)(n.td,{children:"\u22655.14.0"}),(0,t.jsx)(n.td,{children:"9.5"}),(0,t.jsx)(n.td,{children:"fuse3-3.10.2"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Ubuntu 22"}),(0,t.jsx)(n.td,{children:"\u22655.15.0"}),(0,t.jsx)(n.td,{children:"22.4"}),(0,t.jsx)(n.td,{children:"fuse3-3.10.5"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"resource-requirements",children:"Resource Requirements"}),"\n",(0,t.jsx)(n.p,{children:"Curvine has no minimum resource requirements and can support extremely high concurrency and traffic with very small resources. Here is a reference configuration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"CPU: 2 cores"}),"\n",(0,t.jsx)(n.li,{children:"Memory: 4GB"}),"\n",(0,t.jsx)(n.li,{children:"Network: 10Gbps"}),"\n",(0,t.jsx)(n.li,{children:"SSD disk: 1 unit"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Based on this reference, you can extrapolate other hardware resource requirements from one resource value.\nFor example, if you have 2 SSD disks, you would need 4 CPU cores, 8GB memory, and 20Gbps bandwidth. 4GB memory is also acceptable, depending on business concurrency - if concurrency is not high, memory doesn't need to be increased."}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsx)(n.p,{children:"This is for reference only. Actual requirements depend on your specific business needs."})}),"\n",(0,t.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,t.jsx)(n.h3,{id:"build-from-source",children:"Build From Source"}),"\n",(0,t.jsxs)(n.p,{children:["Compile the software installation package. For compilation instructions, refer to ",(0,t.jsx)(n.a,{href:"/docs/Deploy/quick-start",children:"Quick Start"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Execute the following command to create an installation package:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sh build/build.sh -r zip\n"})}),"\n",(0,t.jsxs)(n.p,{children:["After successful compilation, a ",(0,t.jsx)(n.code,{children:"curvine.zip"})," file will be generated in the ",(0,t.jsx)(n.code,{children:"build/dist"})," directory. This file is the Curvine installation package that can be used for deployment or building images."]}),"\n",(0,t.jsx)(n.h3,{id:"configuration-file-modification",children:"Configuration File Modification"}),"\n",(0,t.jsxs)(n.p,{children:["The environment variable configuration file is located at ",(0,t.jsx)(n.code,{children:"config/env.sh"}),". This file is a bash script used to configure Curvine's environment variables.\nThe environment variable that needs to be modified is ",(0,t.jsx)(n.code,{children:"LOCAL_HOSTNAME"}),", which is very important as it specifies the hostname for Curvine. The Curvine cluster relies on it to identify cluster members.\nIt's recommended to set it to the local hostname:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"export LOCAL_HOSTNAME=$(hostname)\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Curvine's configuration file is located at ",(0,t.jsx)(n.code,{children:"config/curvine.toml"}),". This is a TOML format configuration file containing various Curvine configurations. The configurations that typically need modification are:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Configure master node addresses"}),"\n",(0,t.jsx)(n.li,{children:"Configure worker storage directories"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here's an example configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'format_master = false\nformat_worker = false\n\n[master]\n# Configure metadata storage directory\nmeta_dir = "data/meta"\n\n# Configure master log directory\nlog = { level = "info", log_dir = "logs", file_name = "master.log" }\n\n[journal]\n# Configure raft master node list. hostname must match LOCAL_HOSTNAME environment variable, otherwise master nodes cannot be identified.\n# id must be an integer and cannot be duplicated. port is the master raft port, default is 8996\njournal_addrs = [\n    {id = 1, hostname = "master1", port = 8996},\n    {id = 2, hostname = "master2", port = 8996},\n    {id = 3, hostname = "master3", port = 8996}\n]\n\n# Configure raft log storage directory\njournal_dir = "testing/journal"\n\n[worker]\n# Reserved space, default is 0\ndir_reserved = "0"\n\n# Configure worker storage directories\ndata_dir = [\n    "[SSD]/data/data1",\n    "[SSD]/data/data2"\n]\n\n# Configure worker logs\nlog = { level = "info", log_dir = "logs", file_name = "worker.log" }\n\n[client]\n# Configure master addresses, port is master RPC port, default is 8995\nmaster_addrs = [\n    { hostname = "master1", port = 8995 },\n    { hostname = "master2", port = 8995 },\n    { hostname = "master3", port = 8995 },\n]\n\n# Client log configuration\n[log]\nlevel = "info"\nlog_dir = "logs"\nfile_name = "curvine.log"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["If you need to use the Java Hadoop client, modify the ",(0,t.jsx)(n.code,{children:"fs.cv.master_addrs"})," value in ",(0,t.jsx)(n.code,{children:"curvine-site.xml"}),", example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:"<property>\n    <name>fs.cv.master_addrs</name>\n    <value>master1:8995,master2:8995,master3:8995</value>\n</property>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"non-container-deployment",children:"Non-Container Deployment"}),"\n",(0,t.jsx)(n.p,{children:"Non-container deployment requires manually starting Curvine master and worker. The startup commands are:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Start master\nbin/curvine-master.sh start\n\n# Start worker\nbin/curvine-worker.sh start\n\n# FUSE mount\nbin/curvine-fuse.sh start\n"})}),"\n",(0,t.jsx)(n.h3,{id:"container-deployment",children:"Container Deployment"}),"\n",(0,t.jsxs)(n.p,{children:["After code compilation is complete, copy the compiled zip package to the ",(0,t.jsx)(n.code,{children:"curvine-docker/deploy"})," directory and execute the following command to build the image:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Default image name: curvine:latest\nsh build-img.sh\n\n# View the compiled image\ndocker images | grep curvine\n"})}),"\n",(0,t.jsx)(n.p,{children:"Start services:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Start a test master and worker\ndocker run -d \\\n--name curvine-cluster \\\n-p 8995:8995 -p 8996:8996 -p 8997:8997 -p 9000:9000 -p 9001:9001 \\\nlocalhost/curvine:latest \\\n/bin/sh /entrypoint.sh all start\n\n# Start master\ndocker run -d \\\n--name curvine-master \\\n-p 8995:8995 -p 8996:8996 -p 8997:8997 -p 9000:9000 \\\nlocalhost/curvine:latest \\\n/bin/sh /entrypoint.sh master start\n\n# Start worker\ndocker run -d \\\n--name curvine-worker \\\n-p 9001:9001 \\\nlocalhost/curvine:latest \\\n/bin/sh /entrypoint.sh worker start\n"})}),"\n",(0,t.jsx)(n.h3,{id:"kubernetes-deployment",children:"Kubernetes Deployment"}),"\n",(0,t.jsx)(n.p,{children:"To be supplemented."}),"\n",(0,t.jsx)(n.h3,{id:"metrics-collection",children:"Metrics Collection"}),"\n",(0,t.jsx)(n.p,{children:"Master and worker expose monitoring metrics through HTTP interfaces. These metrics can be collected by Prometheus and visualized through Grafana."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Master metrics: ",(0,t.jsx)(n.code,{children:"http://URL_ADDRESS:9000/metrics"})]}),"\n",(0,t.jsxs)(n.li,{children:["Worker metrics: ",(0,t.jsx)(n.code,{children:"http://URL_ADDRESS:9001/metrics"})]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>l});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);