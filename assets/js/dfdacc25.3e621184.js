"use strict";(self.webpackChunkcurvine_doc=self.webpackChunkcurvine_doc||[]).push([[3641],{1016:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/mount-arch-28e876de87faeb098511139b1b6f3793.png"},5732:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"User-Manuals/Key-Features/ufs","title":"Data Orchestration","description":"Curvine provides UFS (Unified File System) view to manage all supported distributed storage systems, including s3/hdfs etc.","source":"@site/docs/3-User-Manuals/1-Key-Features/01-ufs.md","sourceDirName":"3-User-Manuals/1-Key-Features","slug":"/User-Manuals/Key-Features/ufs","permalink":"/docs/User-Manuals/Key-Features/ufs","draft":false,"unlisted":false,"editUrl":"https://github.com/curvineio/curvine-doc/edit/main/docs/3-User-Manuals/1-Key-Features/01-ufs.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"User Manuals","permalink":"/docs/category/user-manuals"},"next":{"title":"Cache","permalink":"/docs/User-Manuals/Key-Features/cache"}}');var i=t(4848),r=t(8453);const a={},c="Data Orchestration",d={},o=[{value:"Mounting",id:"mounting",level:2},{value:"Mount Modes",id:"mount-modes",level:3},{value:"Write Cache",id:"write-cache",level:4},{value:"Read Cache",id:"read-cache",level:4},{value:"Unified Access",id:"unified-access",level:2},{value:"Disabling Unified Access",id:"disabling-unified-access",level:2}];function l(e){const n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"data-orchestration",children:"Data Orchestration"})}),"\n",(0,i.jsx)(n.p,{children:"Curvine provides UFS (Unified File System) view to manage all supported distributed storage systems, including s3/hdfs etc."}),"\n",(0,i.jsx)(n.mermaid,{value:'flowchart TD\n    subgraph Application Layer\n        App[Application]\n    end\n\n    subgraph UFS Backend Layer - curve-ufs\n        UEnum[UfsFileSystem enum]\n        OFS[OpendalFileSystem]\n        ODO[OpenDAL Operator]\n    end\n\n    subgraph Unified File System Layer\n        UFS[UnifiedFileSystem]\n        \n        subgraph Path Resolution\n            GM["get_mount()"<br/>Check mount point]\n            TP["toggle_path()"<br/>Convert CV \u2194 UFS]\n        end\n        MC[MountCache<br/>TTL-based cache]\n    end\n\n    subgraph External Storage\n        S3[S3/OSS/COS]\n        HDFS[HDFS/WebHDFS]\n        Azure[Azure Blob]\n        GCS[Google Cloud Storage]\n    end\n\n    subgraph Curve Cache Layer\n        CFS[CurveFileSystem]\n        FSC[FsClient<br/>RPC to Master]\n    end\n\n    App --\x3e UFS\n    UFS --\x3e GM\n    UFS --\x3e TP\n    UFS --\x3e MC\n    UFS --\x3e UEnum\n    MC --\x3e CFS\n    CFS --\x3e FSC\n    UEnum --\x3e OFS\n    OFS --\x3e ODO\n    ODO --\x3e S3\n    ODO --\x3e HDFS\n    ODO --\x3e Azure\n    ODO --\x3e GCS'}),"\n",(0,i.jsx)(n.h2,{id:"mounting",children:"Mounting"}),"\n",(0,i.jsx)(n.p,{children:"Curvine supports connecting multiple UFS sources by mounting them to different Curvine paths. Curvine does not provide default UFS configuration, which means if you want to load data from UFS, you must first mount the UFS source."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"mount-arch",src:t(1016).A+"",width:"2114",height:"876"})}),"\n",(0,i.jsx)(n.p,{children:"Curvine persists the mount table in metadata, so there is no need to remount when Curvine restarts. However, some rules must be followed."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Mounting to the root path is not allowed."}),"\n",(0,i.jsx)(n.li,{children:"Mounting other UFS under a mounted path is not allowed."}),"\n",(0,i.jsx)(n.li,{children:"The same mount path cannot be mounted to different UFS."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Mount command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"bin/cv mount ufs_path curvine_path [configs]\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"ufs_path: UFS path, e.g., s3://bucket/path."}),"\n",(0,i.jsx)(n.li,{children:"curvine_path: Curvine path, e.g., /ufs/path."}),"\n",(0,i.jsx)(n.li,{children:"configs: Optional parameters, e.g., access_key_id, secret_access_key, region, endpoint, etc."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"bin/cv mount s3://ai/xuen-test /s3 \\\n-c s3.endpoint_url=http://hostname.com \\\n-c s3.region_name=cn \\\n-c s3.credentials.access=access_key \\\n-c s3.credentials.secret=secret_key \\\n-c s3.path_style=true\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"You can use command line, API to access ufs directories and files after UFS is mounted, but ufs data will not be automatically synchronized to curvine unless you load specific paths."})}),"\n",(0,i.jsx)(n.h3,{id:"mount-modes",children:"Mount Modes"}),"\n",(0,i.jsx)(n.h4,{id:"write-cache",children:"Write Cache"}),"\n",(0,i.jsx)(n.p,{children:"WriteType controls the write behavior between Curvine cache and underlying storage (UFS)"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Mode"}),(0,i.jsx)(n.th,{children:"Behavior (Sync/Async)"}),(0,i.jsx)(n.th,{children:"Consistency"}),(0,i.jsx)(n.th,{children:"Use Cases"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Cache mode"}),(0,i.jsx)(n.td,{children:"Write only to Curvine cache, not sync to UFS"}),(0,i.jsx)(n.td,{children:"Cache-only consistency, no data in UFS"}),(0,i.jsx)(n.td,{children:"Temporary data, scratch data, disposable intermediate results"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Through mode"}),(0,i.jsx)(n.td,{children:"Write directly to UFS, bypass cache"}),(0,i.jsx)(n.td,{children:"Strong consistency, data directly persisted to UFS"}),(0,i.jsx)(n.td,{children:"Write-once-read-many scenarios, cache-unbeneficial data"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AsyncThrough mode (default)"}),(0,i.jsx)(n.td,{children:"Write to cache first, async sync to UFS, return immediately"}),(0,i.jsx)(n.td,{children:"Eventual consistency, cache readable immediately, UFS updated async"}),(0,i.jsx)(n.td,{children:"Machine learning training, scenarios balancing performance and persistence"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"CacheThrough mode"}),(0,i.jsx)(n.td,{children:"Sync write to cache and UFS, wait for UFS completion"}),(0,i.jsx)(n.td,{children:"Strong consistency, ensure data exists in both cache and UFS"}),(0,i.jsx)(n.td,{children:"Shared data, scenarios requiring strong persistence guarantees"})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"read-cache",children:"Read Cache"}),"\n",(0,i.jsx)(n.p,{children:"ConsistencyStrategy determines whether consistency validation with underlying storage (UFS) is needed when reading logs"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Mode"}),(0,i.jsx)(n.th,{children:"Behavior"}),(0,i.jsx)(n.th,{children:"Consistency"}),(0,i.jsx)(n.th,{children:"Use Cases"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"None"}),(0,i.jsx)(n.td,{children:"Trust cache, no consistency validation during reads"}),(0,i.jsx)(n.td,{children:"No consistency guarantee, may read stale data"}),(0,i.jsx)(n.td,{children:"High-performance read scenarios, relatively static base data, temporary data/intermediate results"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Always"}),(0,i.jsx)(n.td,{children:"Validate cache matches UFS on every read"}),(0,i.jsx)(n.td,{children:"Strong consistency guarantee, ensure latest data"}),(0,i.jsx)(n.td,{children:"Intermittent data updates, multi-client shared data, strong consistency requirement scenarios"})]})]})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"TTL controls read cache behavior in Curvine by determining cache validity to trigger automatic cache refresh or cleanup operations."})}),"\n",(0,i.jsx)(n.h2,{id:"unified-access",children:"Unified Access"}),"\n",(0,i.jsx)(n.p,{children:"After UFS is mounted, Curvine provides a unified file system view, and you can access the UFS file system just like accessing the Curvine file system;\nClients, command line tools, fuse, etc. can all access the UFS file system through a unified path."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"Curvine does not cache UFS metadata, so there is no data consistency issue when accessing. Accessing UFS through Curvine is no different from accessing UFS directly.\nWhen Curvine cache data read fails, it automatically falls back to reading data from UFS."})}),"\n",(0,i.jsx)(n.h2,{id:"disabling-unified-access",children:"Disabling Unified Access"}),"\n",(0,i.jsx)(n.p,{children:"If you don't want to use unified access, you can add or modify the following configuration:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[client]\nenable_unified_fs = false\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(6540);const i={},r=s.createContext(i);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);